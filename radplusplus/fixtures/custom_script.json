[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Quotation", 
  "modified": "2019-02-04 16:50:39.967691", 
  "name": "Quotation-Client", 
  "script": "///////////////////////////////////////////////////////////////////////\n/////////////////////////// Code specifique ///////////////////////////\n\n/////////////////////////////// Handles ///////////////////////////////\nfrappe.ui.form.on(\"Quotation\",{\t\n\tonload : function(frm) {\n\t\t// Permet d'assigner l'entete de lettre a la commande de vente selon le vendeur selectionne.\n\t\tcur_frm.add_fetch('sales_person','letter_head','letter_head');\n\t\tcur_frm.add_fetch(\"customer\", \"default_taxes\", \"taxes_and_charges\");\n\t},\n\trefresh : function(frm) {\t\t\n\t\tLoadAttributesValues(false, frm, \"items\")\n\t\t\n\t\t// Retrouver la valeur de language du client ou du prospect.\n\t\tif (frm.doc.quotation_to == \"Customer\" && frm.doc.customer){\n\t\t\t// Retrouver la valeur de language\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.get_value\",\n\t\t\t\targs: {\n\t\t\t\t\t\"doctype\": \"Customer\",\n\t\t\t\t\t\"filters\": {\n\t\t\t\t\t\t\"name\": frm.doc.customer\n\t\t\t\t\t},\n\t\t\t\t\t\"fieldname\": [\"language\"]\n\t\t\t\t},\n\t\t\t\tcallback: function(res) {\n\t\t\t\t\tcur_frm.set_value('language', res.message.language);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse if (frm.doc.quotation_to == \"Lead\"){\n\t\t\t// Retrouver la valeur de language\n\t\t\tconsole.log(__(\"frm.doc.lead : \" + frm.doc.lead));\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.get_value\",\n\t\t\t\targs: {\n\t\t\t\t\t\"doctype\": \"Lead\",\n\t\t\t\t\t\"filters\": {\n\t\t\t\t\t\t\"name\": frm.doc.lead\n\t\t\t\t\t},\n\t\t\t\t\t\"fieldname\": [\"language\"]\n\t\t\t\t},\n\t\t\t\tcallback: function(res) {\n\t\t\t\t\tcur_frm.set_value('language', res.message.language);\n\t\t\t\t}\n\t\t\t});\n\t\t} \n\t\t\n\t\tif (!cur_frm.doc.contact_date){\n\t\t\tcur_frm.set_value('contact_date', frappe.datetime.add_days(frappe.datetime.nowdate(), 10));\n\t\t}\n\t\t\n\t\tif (cur_frm.doc.docstatus===0) {\n\t\t\tcur_frm.add_custom_button(__('Soumission pour prospect'),\n\t\t\t\tfunction() {\n\t\t\t\t\tfrappe.prompt([{label:__(\"Name\"), fieldtype:\"Data\", fieldname:\"name\", reqd: 1},\n\t\t\t\t\t\t{label:__(\"Address\"), fieldtype:\"Data\", fieldname:\"address\", reqd: 1, default: \"\"},\n\t\t\t\t\t\t{label:__(\"City/Town\"), fieldtype:\"Data\", fieldname:\"city\", reqd: 1, default: \"\"},\n\t\t\t\t\t\t{label:__(\"State\"), fieldtype:\"Data\", fieldname:\"state\", reqd: 1, default: \"Qu\u00e9bec\"},\n\t\t\t\t\t\t{label:__(\"Country\"), fieldtype:\"Link\", fieldname:\"country\", options: \"Country\", reqd: 1, default: \"Canada\"},\n\t\t\t\t\t\t{label:__(\"Postal Code\"), fieldtype:\"Data\", fieldname:\"pincode\", reqd: 0},\t\n\t\t\t\t\t\t{label:__(\"Email\"), fieldtype:\"Data\", fieldname:\"email_id\", reqd: 0},\n\t\t\t\t\t\t{label:__(\"Phone\"), fieldtype:\"Data\", fieldname:\"phone\", reqd: 0},\t\t\n\t\t\t\t\t\t{label:__(\"Territory\"), fieldtype:\"Link\", fieldname:\"territory\", options: \"Territory\", reqd: 1, default: \"Magasin\"},\t\t\t\t\t\n\t\t\t\t\t\t{label:__(\"Print Language\"), fieldtype:\"Link\", fieldname:\"language\", options: \"Language\", reqd: 1, default: \"fr\"}],\n\t\t\t\t\t\tfunction(data) {\n\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\tmethod:\"myrador.controllers.controllers.make_customer_and_contact_from_quotation_lead\",\n\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\tnom: data.name,\n\t\t\t\t\t\t\t\t\tadresse: data.address,\n\t\t\t\t\t\t\t\t\tville: data.city,\n\t\t\t\t\t\t\t\t\ttelephone: data.phone,\n\t\t\t\t\t\t\t\t\tstate: data.state,\n\t\t\t\t\t\t\t\t\tcountry: data.country,\n\t\t\t\t\t\t\t\t\tpincode: data.pincode,\n\t\t\t\t\t\t\t\t\tterritory: data.territory,\n\t\t\t\t\t\t\t\t\tlanguage: data.language,\n\t\t\t\t\t\t\t\t\temail_id: data.email_id\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcallback: function(res) {\n\t\t\t\t\t\t\t\t\tconsole.log(\"callback\")\n\t\t\t\t\t\t\t\t\tcur_frm.set_value('quotation_to', 'Lead');\n\t\t\t\t\t\t\t\t\tcur_frm.set_value('lead', res.message);\n\t\t\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\t\t\tmethod:\"myrador.controllers.controllers.get_sales_person\",\n\t\t\t\t\t\t\t\t\t\tcallback: function(res) {\n\t\t\t\t\t\t\t\t\t\t\tcur_frm.set_value('sales_person', res.message);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t \n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t, __(\"Entrez les d\u00e9tails du prospect\"), __(\"Termin\u00e9\"));\n\t\t\t\t}, __(\"Soumission rapide\")\n\t\t\t);\n\t\t}\n\t\tif (cur_frm.doc.docstatus===1) {\n\t\t\tcur_frm.add_custom_button(__('Modifier'),\n\t\t\t\tfunction(frm, doc) {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod:\"myrador.controllers.controllers.change_quotation_docstatus\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tdocname: cur_frm.doc.name,\t\t\t\t\t\t\n\t\t\t\t\t\t\tstatus: 0\t\t\t\t\t\t\t\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function(res) {\t\n\t\t\t\t\t\t\tcur_frm.reload_doc();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}, __(\"Modifier\")\n\t\t\t);\n\t\t}\t\t\t\n\t},\n\t// 2016-12-02 - JDLP\n\t// Actualise la valeur du texte options.\n\tqo_name : function(frm, cdt, cdn){\n\t\tvar soi = locals[cdt][cdn];\n\t\tif (soi && soi.qo_name) {\n\t\t\tfrappe.call({\n\t\t\tmethod: \"frappe.client.get_value\",\n\t\t\targs: {\n\t\t\t\t\"doctype\": \"Quotation Options\",\n\t\t\t\t\"fieldname\": [\"options\"],\n\t\t\t\t\"filters\": {\n\t\t\t\t\t\"name\": soi.qo_name\n\t\t\t\t}\n\t\t\t},\n\t\t\tcallback: function(res) {\n\t\t\t\tsoi.set_value('options', res.message.options);\n\t\t\t\t/* options = res.message.options;\n\t\t\t\trefresh_field(\"options\"); */\n\t\t\t}});\n\t\t}\n\t},\n\tsales_person : function(frm, doc) {\n\t\tif (cur_frm.doc.sales_person){\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.get_value\",\n\t\t\t\targs: {\n\t\t\t\t\t\"doctype\": \"Sales Person\",\n\t\t\t\t\t\"fieldname\": [\n\t\t\t\t\t\t\"letter_head\",\n\t\t\t\t\t\t\"employee\"\n\t\t\t\t\t],\n\t\t\t\t\t\"filters\": {\n\t\t\t\t\t\t\"name\": cur_frm.doc.sales_person\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcallback: function(res) {\n\t\t\t\t\tcur_frm.set_value('letter_head', res.message.letter_head);\n\t\t\t\t\tif (res.message.employee){\n\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\tmethod: \"frappe.client.get_value\",\n\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\"doctype\": \"Employee\",\n\t\t\t\t\t\t\t\t\"fieldname\": [\n\t\t\t\t\t\t\t\t\t\"user_id\"\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\"filters\": {\n\t\t\t\t\t\t\t\t\t\"name\": res.message.employee\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcallback: function(res) {\n\t\t\t\t\t\t\t\tif (res && res.message.user_id){\n\t\t\t\t\t\t\t\t\tcur_frm.set_value('sales_person_email', res.message.user_id);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\tsetup : function(frm) {\n\t\tfrm.fields_dict.items.grid.get_field('template').get_query = function() {\n\t\t\treturn erpnext.queries.item({item_group : \"Configurateur\"});\n\t\t};\n\t}/* ,\n\titems_on_form_rendered : function(frm) {\n\t\tsetTimeout(function() {\n\t\t\tvar grid_row = cur_frm.open_grid_row();\t\t\n\t\t\tvar field = grid_row.grid_form.fields_dict.template\n\t\t\tset_focus(field);\n\t\t}, 600);\n\t} */\n});\n\nfrappe.ui.form.on(\"Quotation Item\",{\n\ttemplate : function(frm, cdt, cdn){\n\t\tSetConfiguratorOf(false, frm, cdt, cdn)\t\t\n\t},\n\tcreate_variant : function(frm, cdt, cdn){\n\t\t// Lancer la fonction \"CreateItemVariant\"lorque le bouton \"create_variant\" est active.\n\t\tCreateItemVariant(true, frm, cdt, cdn, true, true)\n\t},\n\treconfigure : function(doc, cdt, cdn) {\n\t\t// Lancer la fonction \"ReconfigurerItemVariant\" lorque le bouton \"reconfigure\" est active.\n\t\tReconfigurerItemVariant(false, doc, cdt, cdn)\n\t},\n\tconfigurator_of : function(frm, cdt, cdn) {\t\n\t\tif (frm.doc.shipper){\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'frappe.client.get_value',\n\t\t\t\targs: {\n\t\t\t\t\t'doctype': 'Customer',\n\t\t\t\t\t'filters': {'name': frm.doc.shipper},\n\t\t\t\t\t'fieldname': [\n\t\t\t\t\t\t'milling'\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc) {\t\n\t\t\t\t\t\tif (r.message.milling) {\n\t\t\t\t\t\t\tShowHideAttributes(false, frm, cdt, cdn, false, true, r.message.milling)\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tShowHideAttributes(false, frm, cdt, cdn, false, true)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\t\t\t\n\t\t}\n\t\telse {\n\t\t\tShowHideAttributes(false, frm, cdt, cdn, false, true)\n\t\t}\n\t}, \n\tconstruction : function(frm, cdt, cdn) {\n\t\tvar row = locals[cdt][cdn];\t\t\n\t\tif (row.construction == \"Massif\"){\n\t\t\tfrappe.model.set_value(row.doctype, row.name, 'thickness', '3/4\"');\n\t\t\tfrappe.model.set_value(row.doctype, row.name, 'length', \"1' a\u0300 7'\");\t\n\t\t\tconsole.log(\"1' a\u0300 7'\")\n\t\t}\n\t\tif (row.construction == \"Hardwood\"){\n\t\t\tfrappe.model.set_value(row.doctype, row.name, 'thickness', '3/4\"');\n\t\t\tfrappe.model.set_value(row.doctype, row.name, 'length', \"1' to 7'\");\n\t\t\tconsole.log('1\\' to 7\\'')\n\t\t}\n\t\tif (row.construction.toString().substring(0,10) == \"Ing\u00e9nierie\" ){\n\t\t\tfrappe.model.set_value(row.doctype, row.name, 'thickness', __('5/8\"'));\n\t\t\tfrappe.model.set_value(row.doctype, row.name, 'length', \"1' a\u0300 8'\");\n\t\t}\n\t\tif (row.construction.toString().substring(0,10) == \"Engineered\"){\n\t\t\tfrappe.model.set_value(row.doctype, row.name, 'thickness', '5/8\"');\n\t\t\tfrappe.model.set_value(row.doctype, row.name, 'length', '1\\' to 8\\'');\n\t\t}\n\t}\n});\n\n\n///////////////////////////// FIN Handles /////////////////////////////\n\n////////////////////////////// Methodes ///////////////////////////////\n// 2016-10-24 - JDLP\n// Script fonctionnel\n// Permet d'assigner les valeurs par defaut\nfunction AssignDefaultValues(printDebug, frm, cdt, cdn) {\n    if (printDebug) console.log(__(\"AssignDefaultValues\"));\n\n    var soi = locals[cdt][cdn];\n    if (soi && soi.item_code) {\n        \t\n    }\n\n    if (printDebug) console.log(__(\"END AssignDefaultValues\"));\n}\n\n\n//////////////////////////// Fin Methodes /////////////////////////////\n///////////////////////// FIN Code specifique /////////////////////////\n///////////////////////////////////////////////////////////////////////\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Order", 
  "modified": "2019-03-28 15:33:26.157370", 
  "name": "Sales Order-Client", 
  "script": "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\n///////////////////////////////////////////////////////////////////////\n/////////////////////////// Code specifique ///////////////////////////\nvar print_debug = false\n\n/////////////////////////////// Handles ///////////////////////////////\nfrappe.ui.form.on(\"Sales Order\",{\n\tonload : function(frm) {\n\t\tcur_frm.add_fetch(\"customer\", \"language\", \"language\");\n\t\tcur_frm.add_fetch(\"customer\", \"default_taxes\", \"taxes_and_charges\");\n\t\tcur_frm.add_fetch(\"customer\", \"default_warehouse\", \"default_warehouse\");\n\t\t// Permet d'assigner l'entete de lettre a la commande de vente selon le vendeur selectionne.\n\t\tcur_frm.add_fetch('sales_person','letter_head','letter_head')\n\t},\n\t\n\trefresh : function(frm) {\n\t\t// Lancer la fonction \"LoadAttributesValues\" au \"onLoad\" du formulaire parent.\n\t\tLoadAttributesValues(print_debug, frm, \"items\")\n\t\t\n\t\t// Retrouver la valeur de language\n\t\tif (frm.doc.customer){\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.get_value\",\n\t\t\t\targs: {\n\t\t\t\t\t\"doctype\": \"Customer\",\n\t\t\t\t\t\"filters\": {\n\t\t\t\t\t\t\"name\": frm.doc.customer\n\t\t\t\t\t},\n\t\t\t\t\t\"fieldname\": [\"language\"]\n\t\t\t\t},\n\t\t\t\tcallback: function(res) {\n\t\t\t\t\tcur_frm.set_value('language', res.message.language);\n\t\t\t\t\t// refresh_field(\"language\");\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t\n\t\tif (cur_frm.doc.docstatus===0) {\n\t\t\tcur_frm.add_custom_button(__('Nouveau particulier'),\n\t\t\t\tfunction() {\n\t\t\t\t\tfrappe.prompt([{label:__(\"Name\"), fieldtype:\"Data\", fieldname:\"name\", reqd: 1},\n\t\t\t\t\t\t{label:__(\"Address\"), fieldtype:\"Data\", fieldname:\"address\", reqd: 1},\n\t\t\t\t\t\t{label:__(\"City/Town\"), fieldtype:\"Data\", fieldname:\"city\", reqd: 1},\n\t\t\t\t\t\t{label:__(\"State\"), fieldtype:\"Data\", fieldname:\"state\", reqd: 1, default: \"Qc\"},\n\t\t\t\t\t\t{label:__(\"Country\"), fieldtype:\"Link\", fieldname:\"country\", options: \"Country\", reqd: 1, default: \"Canada\"},\n\t\t\t\t\t\t{label:__(\"Postal Code\"), fieldtype:\"Data\", fieldname:\"pincode\", reqd: 0},\n\t\t\t\t\t\t{label:__(\"Email\"), fieldtype:\"Data\", fieldname:\"email_id\", reqd: 0},\n\t\t\t\t\t\t{label:__(\"Phone\"), fieldtype:\"Data\", fieldname:\"phone\", reqd: 0},\t\t\t\t\t\n\t\t\t\t\t\t{label:__(\"Territory\"), fieldtype:\"Link\", fieldname:\"territory\", options: \"Territory\", reqd: 1, default: \"Magasin\"},\n\t\t\t\t\t\t{label:__(\"Print Language\"), fieldtype:\"Link\", fieldname:\"language\", options: \"Language\", reqd: 1, default: \"fr\"}],\n\t\t\t\t\t\tfunction(data) {\n\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\tmethod:\"myrador.controllers.controllers.make_customer_and_contact_from_sales_order_standard\",\n\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\tnom: data.name,\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tadresse: data.address,\n\t\t\t\t\t\t\t\t\tville: data.city,\n\t\t\t\t\t\t\t\t\ttelephone: data.phone,\n\t\t\t\t\t\t\t\t\tstate: data.state,\n\t\t\t\t\t\t\t\t\tcountry: data.country,\n\t\t\t\t\t\t\t\t\tpincode: data.pincode,\n\t\t\t\t\t\t\t\t\tcustomer_type: \"Individual\",\n\t\t\t\t\t\t\t\t\tcustomer_group: \"Direct\",\n\t\t\t\t\t\t\t\t\tterritory: data.territory,\n\t\t\t\t\t\t\t\t\tlanguage: data.language,\n\t\t\t\t\t\t\t\t\temail_id: data.email_id\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcallback: function(res) {\n\t\t\t\t\t\t\t\t\tcur_frm.set_value('customer', res.message);\n\t\t\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\t\t\tmethod:\"myrador.controllers.controllers.get_sales_person\",\n\t\t\t\t\t\t\t\t\t\tcallback: function(res) {\n\t\t\t\t\t\t\t\t\t\t\tcur_frm.set_value('sales_person', res.message);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\t\t\t\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t \n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t, __(\"Entrez les d\u00e9tails du client\"), __(\"Termin\u00e9\"));\n\t\t\t\t}, __(\"Nouveau client\")\n\t\t\t);\n\t\t}\t\n\t\t\n\t\tif (cur_frm.doc.docstatus===0) {\n\t\t\tcur_frm.add_custom_button(__('Nouveau contracteur'),\n\t\t\t\tfunction() {\n\t\t\t\t\tfrappe.prompt([{label:__(\"Name\"), fieldtype:\"Data\", fieldname:\"name\", reqd: 1},\n\t\t\t\t\t\t{label:__(\"Address\"), fieldtype:\"Data\", fieldname:\"address\", reqd: 1},\n\t\t\t\t\t\t{label:__(\"City/Town\"), fieldtype:\"Data\", fieldname:\"city\", reqd: 1},\n\t\t\t\t\t\t{label:__(\"State\"), fieldtype:\"Data\", fieldname:\"state\", reqd: 1, default: \"Qc\"},\n\t\t\t\t\t\t{label:__(\"Country\"), fieldtype:\"Link\", fieldname:\"country\", options: \"Country\", reqd: 1, default: \"Canada\"},\n\t\t\t\t\t\t{label:__(\"Postal Code\"), fieldtype:\"Data\", fieldname:\"pincode\", reqd: 0},\n\t\t\t\t\t\t{label:__(\"Email\"), fieldtype:\"Data\", fieldname:\"email_id\", reqd: 0},\n\t\t\t\t\t\t{label:__(\"Phone\"), fieldtype:\"Data\", fieldname:\"phone\", reqd: 0},\t\t\t\t\t\n\t\t\t\t\t\t{label:__(\"Territory\"), fieldtype:\"Link\", fieldname:\"territory\", options: \"Territory\", reqd: 1, default: \"Magasin\"},\n\t\t\t\t\t\t{label:__(\"Print Language\"), fieldtype:\"Link\", fieldname:\"language\", options: \"Language\", reqd: 1, default: \"fr\"}],\n\t\t\t\t\t\tfunction(data) {\n\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\tmethod:\"myrador.controllers.controllers.make_customer_and_contact_from_sales_order_standard\",\n\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\tnom: data.name,\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tadresse: data.address,\n\t\t\t\t\t\t\t\t\tville: data.city,\n\t\t\t\t\t\t\t\t\ttelephone: data.phone,\n\t\t\t\t\t\t\t\t\tstate: data.state,\n\t\t\t\t\t\t\t\t\tcountry: data.country,\n\t\t\t\t\t\t\t\t\tpincode: data.pincode,\n\t\t\t\t\t\t\t\t\tcustomer_type: \"Company\",\n\t\t\t\t\t\t\t\t\tcustomer_group: \"Contracteur\",\n\t\t\t\t\t\t\t\t\tterritory: data.territory,\n\t\t\t\t\t\t\t\t\tlanguage: data.language,\n\t\t\t\t\t\t\t\t\temail_id: data.email_id\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcallback: function(res) {\n\t\t\t\t\t\t\t\t\tcur_frm.set_value('customer', res.message);\n\t\t\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\t\t\tmethod:\"myrador.controllers.controllers.get_sales_person\",\n\t\t\t\t\t\t\t\t\t\tcallback: function(res) {\n\t\t\t\t\t\t\t\t\t\t\tcur_frm.set_value('sales_person', res.message);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\t\t\t\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t \n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t, __(\"Entrez les d\u00e9tails du client\"), __(\"Termin\u00e9\"));\n\t\t\t\t}, __(\"Nouveau client\")\n\t\t\t);\n\t\t}\t\n\t\t\n\t\tif (cur_frm.doc.docstatus===1) {\n\t\t\tcur_frm.add_custom_button(__('Modifier'),\n\t\t\t\tfunction(frm, doc) {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod:\"myrador.controllers.controllers.change_sales_order_docstatus\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tdocname: cur_frm.doc.name,\t\t\t\t\t\t\n\t\t\t\t\t\t\tstatus: 0\t\t\t\t\t\t\t\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function(res) {\t\n\t\t\t\t\t\t\tcur_frm.reload_doc();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}, __(\"Modifier\")\n\t\t\t);\n\t\t}\t\t\t\t\n\t},\n\tsetup : function(frm) {\n\t\tfrm.fields_dict.items.grid.get_field('template').get_query = function() {\n\t\t\treturn erpnext.queries.item({item_group : \"Configurateur\"});\n\t\t};\n\t},\n\tcontact_person: function(frm) {\n\t\terpnext.utils.get_contact_details(frm);\n\t},\n\tcustomer: function(frm) {\n\t\tsetTimeout(function() {\n\t\t\tif (cur_frm.doc.contact_person){\t\t\t\n\t\t\t\terpnext.utils.get_contact_details(frm);\n\t\t\t}\n\t\t}, 300);\n\t},\n\titems_on_form_rendered : function(frm, cdt, cdn) {\n\t\tShowHideAttributes(print_debug, frm, cdt, cdn, false, true)\n\t\tsetTimeout(function() {\n\t\t\tvar grid_row = cur_frm.open_grid_row();\t\t\n\t\t\tvar field = grid_row.grid_form.fields_dict.template\n\t\t\tset_focus(field);\n\t\t}, 600);\n\t}\n});\n\nfrappe.ui.form.on(\"Sales Order Item\",{\n\tget_item_from_batch : function(frm,cdt,cdn){\t\n\t\tvar item = locals[cdt][cdn];\n\t\tvar fields = \n\t\t[\n\t\t\t{\n\t\t\t\tfieldname: 'lot',\n\t\t\t\tfieldtype: 'Link',\n\t\t\t\tlabel: 'Lot',\n\t\t\t\toptions:'Batch'\n\t\t\t}\n\t\t]\n\t\tvar row = locals[cdt][cdn];\n\t\tvar d = new frappe.ui.Dialog({\n\t\t\ttitle: __('Choisir le lot d\u00e9sir\u00e9'),\n\t\t\tfields: fields,\n\t\t\tprimary_action: function() {\n\t\t\t\tvar data = d.get_values();\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: 'frappe.client.get_value',\n\t\t\t\t\targs: {\n\t\t\t\t\t\t'doctype': 'Batch',\n\t\t\t\t\t\t'filters': {'name': data.lot},\n\t\t\t\t\t\t'fieldname': [\n\t\t\t\t\t\t\t'item'\n\t\t\t\t\t\t]\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tif (!r.exc) {\t\n\t\t\t\t\t\t\tif (r.message.item) {\n\t\t\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name, \"item_code\", r.message.item);\n\t\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\t\t\n\t\t\t},\n\t\t\tprimary_action_label: __('Copier le lot')\n\t\t});\n\t\td.show();\n\t},\n\titem_code : function(frm,cdt,cdn){\t\t\n\t\t\n\t\tsetTimeout(function () {\t\n\t\t\tvar row = locals[cdt][cdn];\t\n\t\t\tfrappe.call({\n\t\t\t\tmethod:\"myrador.controllers.controllers.get_total_rate_from_sales_order\",\n\t\t\t\targs: {\n\t\t\t\t\t\"self\": row,\n\t\t\t\t\t\"customer\": cur_frm.doc.customer\n\t\t\t\t},\n\t\t\t\tcallback: function(res) {\n\t\t\t\t\tif (res.message != null){\n\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name, \"rate\", res.message.total_rate);\n\t\t\t\t\t\t// refresh_field(\"rate\");\n\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name, \"description_sous_traitance\", res.message.description);\n\t\t\t\t\t\t// refresh_field(\"description_sous_traitance\");\n\t\t\t\t\t}\n\t\t\t\t\tcur_frm.cur_grid.frm.script_manager.trigger('sales_order_type',cdt,cdn);\n\t\t\t\t}\n\t\t\t});\n\t\t}, 500)\t\t\t\t\t\n\t},\t\n\ttemplate : function(frm, cdt, cdn){\n\t\tSetConfiguratorOf(print_debug, frm, cdt, cdn)\t\t\n\t},\n\tcreate_variant : function(frm, cdt, cdn) {\n\t\t// Lancer la fonction \"CreateItemVariant\"lorque le bouton \"create_variant\" est active.\n\t\tCreateItemVariant(print_debug, frm, cdt, cdn, true, false)\n\t},\n\treconfigure : function(doc, cdt, cdn) {\n\t\t// Lancer la fonction \"ReconfigurerItemVariant\" lorque le bouton \"reconfigure\" est active.\n\t\t// dialog_configurator(print_debug,doc, cdt, cdn)\n\t\tReconfigurerItemVariant(print_debug, doc, cdt, cdn)\n\t},\n\tconfigurator_of : function(frm, cdt, cdn) {\t\n\t\tif (frm.doc.shipper){\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'frappe.client.get_value',\n\t\t\t\targs: {\n\t\t\t\t\t'doctype': 'Customer',\n\t\t\t\t\t'filters': {'name': frm.doc.shipper},\n\t\t\t\t\t'fieldname': [\n\t\t\t\t\t\t'milling'\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc) {\t\n\t\t\t\t\t\tif (r.message.milling) {\n\t\t\t\t\t\t\tShowHideAttributes(print_debug, frm, cdt, cdn, false, true)\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tShowHideAttributes(print_debug, frm, cdt, cdn, false, true)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\t\t\t\n\t\t}\n\t\telse {\n\t\t\tShowHideAttributes(print_debug, frm, cdt, cdn, false, true)\n\t\t}\n\t}, \n\tsales_order_type : function(frm, cdt, cdn) {\t\n\t\tvar row = locals[cdt][cdn];\t\n\t\t\n\t\tconsole.log(__(\"sales_order_type\" ));\t\n\t\tvar stock_order_type_list = [\"Surplus d'inventaire\",\"Liquidation\"];\n\t\tif ([\"Surplus d'inventaire\",\"Liquidation\"].includes(row.sales_order_type)){\n\t\t\tfrappe.model.set_value(row.doctype, row.name, \"use_stock\", 1);\n\t\t\tif (row.sales_order_type == \"Surplus d'inventaire\"){\n\t\t\t\tfrappe.model.set_value(row.doctype, row.name, \"warehouse\", \"Magasins - BFM\");\n\t\t\t}\n\t\t\telse {\t\t\t\t\n\t\t\t\tfrappe.model.set_value(row.doctype, row.name, \"warehouse\", \"Liquidation - BFM\");\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tfrappe.model.set_value(row.doctype, row.name, \"use_stock\", 0);\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'frappe.client.get_value',\n\t\t\t\targs: {\n\t\t\t\t\t'doctype': 'Item',\n\t\t\t\t\t'filters': {'name': row.item_code},\n\t\t\t\t\t'fieldname': [\n\t\t\t\t\t\t'default_warehouse'\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc) {\t\n\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name, \"warehouse\", r.message.default_warehouse);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name, \"warehouse\", \"\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\t\n\t\t}\n\t}, \n\tconstruction : function(frm, cdt, cdn) {\n\t\tvar row = locals[cdt][cdn];\t\t\n\t\tshow_construction(print_debug,row)\n\t},\n\tst_finition : function(frm, cdt, cdn) {\t\t\n\t\tvar row = locals[cdt][cdn];\n\t\trefresh_st(true,row,cdt,cdn)\t\t\n\t},\n\tst_v_joint : function(frm, cdt, cdn) {\t\t\n\t\tvar row = locals[cdt][cdn];\n\t\trefresh_st(true,row,cdt,cdn)\n\t},\n\tst_emballage : function(frm, cdt, cdn) {\n\t\tvar row = locals[cdt][cdn];\n\t\trefresh_st(true,row,cdt,cdn)\t\t\n\t},\n\tst_wirebrush : function(frm, cdt, cdn) {\n\t\tvar row = locals[cdt][cdn];\n\t\trefresh_st(true,row,cdt,cdn)\t\t\n\t},\n\tst_reclassage : function(frm, cdt, cdn) {\n\t\tvar row = locals[cdt][cdn];\n\t\trefresh_st(true,row,cdt,cdn)\t\t\n\t},\n\tst_melange_lot : function(frm, cdt, cdn) {\n\t\tvar row = locals[cdt][cdn];\n\t\trefresh_st(true,row,cdt,cdn)\t\t\n\t},\n\tduplicate_row : function(frm,cdt,cdn){\n\t\tif (print_debug) console.log(__(\"duplicate_row\"));\n\t\t\n\t\tvar row = locals[cdt][cdn];\n\t\tvar newrow = frappe.model.add_child(frm.doc, \"Sales Order Item\", \"items\");\n\t\tif (typeof row.s_warehouse !== \"undefined\"){\t\t\t\n\t\t\tnewrow.s_warehouse = row.s_warehouse\n\t\t}\n\t\tif (typeof row.t_warehouse !== \"undefined\"){\t\t\t\n\t\t\tnewrow.t_warehouse = row.t_warehouse\n\t\t}\n\t\tnewrow.item_code = row.item_code\t\n\t\tnewrow.item_name = row.item_name\t\n\t\tnewrow.description = row.description\t\n\t\tnewrow.delivery_date = row.delivery_date\n\t\tnewrow.commentaires = row.commentaires\t\t\t\n\t\tnewrow.qty = row.qty\n\t\tnewrow.uom = row.uom\n\t\tnewrow.conversion_factor = row.conversion_factor\n\t\tnewrow.stock_uom = row.stock_uom\n\t\tnewrow.rate = row.rate\n\t\tnewrow.warehouse = row.warehouse\n\t\tnewrow.st_finition = row.st_finition\n\t\tnewrow.st_v_joint = row.st_v_joint\n\t\tnewrow.st_emballage = row.st_emballage\n\t\tnewrow.st_wirebrush = row.st_wirebrush\n\t\tnewrow.st_reclassage = row.st_reclassage\n\t\tnewrow.st_melange_lot = row.st_melange_lot\n\t\tnewrow.description_sous_traitance = row.description_sous_traitance\n\t\t\n\t\tif (print_debug) console.log(__(\"newrow.idx : \" + cstr(newrow.idx)));\n\t\tvar idx = newrow.idx-1;\n\t\t\n\t\trefresh_field(\"items\");\n\t\t\n\t\tcur_frm.get_field(\"items\").grid.grid_rows[idx].toggle_view(true);\n\t\t\n\t\t//cur_frm.refresh()\n\t\t//var grid_row = frappe.ui.form.get_open_grid_form();\n\t\t//grid_row && grid_row.toggle_view(false, function() { grid_row.open_next() });\n\t}\n});\t\n\t\n\n\n///////////////////////////// FIN Handles /////////////////////////////\n\n////////////////////////////// Methodes ///////////////////////////////\n\n\nfunction dialog_configurator(printDebug, doc, cdt, cdn) {\t\n\tvar row = locals[cdt][cdn];\n\tfrappe.call({\n\t\tmethod: 'radplusplus.radplusplus.controllers.configurator.get_fields',\n\t\targs: {\n\t\t\t'item_code': row.item_code\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tif(!r.message) {\n\t\t\t\tconsole.log(\"on_submit - !r.message #1\")\n\t\t\t\treturn;\n\t\t\t}\n\t\t\telse if(!r.message) {\n\t\t\t\tconsole.log(\"on_submit - !r.message #2\")\n\t\t\t\treturn;\n\t\t\t} else {\t\t\t\t\t\n\t\t\t\tconsole.log(\"on_submit - msgbox en cours de creation\")\n\t\t\t\tvar fields = r.message\n\t\t\t\tvar d = new frappe.ui.Dialog({\n\t\t\t\t\ttitle: __('Select Sales Order Lines to close'),\n\t\t\t\t\tfields: fields,\n\t\t\t\t\tprimary_action: function() {\n\t\t\t\t\t\tvar data = d.get_values();\n\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\tmethod: 'myrador.controllers.stock_controllers.close_sales_order_lines',\n\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\titems: data\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfreeze: true,\n\t\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\t\tif(r.message) {\n\t\t\t\t\t\t\t\t\tfrappe.msgprint({\n\t\t\t\t\t\t\t\t\t\tmessage: __('Sales Orders updated'),\n\t\t\t\t\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tprimary_action_label: __('Update')\n\t\t\t\t});\n\t\t\t\td.show();\n\t\t\t}\n\t\t}\n\t});\n}\n\n\n// 2017-06-08 - RENMAI\n// Script fonctionnel\n// Permet de calculer le taux de sous-traitance.\nfunction refresh_st(printDebug, frm, cdt, cdn) {\t\n\tif (printDebug) console.log(__(\"frm.name : \" + frm.name));\t\t\n\tfrappe.call({\n\t\tmethod:\"myrador.controllers.controllers.get_total_rate_from_sales_order\",\n\t\targs: {\n\t\t\t\"self\": frm,\n\t\t\t\"customer\": cur_frm.doc.customer\n\t\t},\n\t\tcallback: function(res) {\n\t\t\tconsole.log(\"res.message:\" + res.message);\n\t\t\tif (res.message != null){\n\t\t\t\tfrappe.model.set_value(frm.doctype, frm.name, \"rate\", res.message.total_rate);\n\t\t\t\t// refresh_field(\"rate\");\n\t\t\t\tfrappe.model.set_value(frm.doctype, frm.name, \"description_sous_traitance\", res.message.description);\n\t\t\t\t// refresh_field(\"description_sous_traitance\");\n\t\t\t}\n\t\t\telse{\n\t\t\t\tfrappe.model.set_value(frm.doctype, frm.name, \"rate\", frm.price_list_rate);\n\t\t\t}\n\t\t}\n\t});\n}\n\n// 2016-10-24 - JDLP\n// Script fonctionnel\n// Permet d'assigner les valeurs par defaut\nfunction AssignDefaultValues(printDebug, frm, cdt, cdn) {\n    if (printDebug) console.log(__(\"AssignDefaultValues\"));\n\n    /* var soi = locals[cdt][cdn];\n    if (soi && soi.item_code) {\n        // S'il n'y a aucune valeur, assigner la valeur du warehouse du client dans la ligne\n\t\tif (printDebug) console.log(__(\"warehouse:\" + frm.cur_grid.doc.warehouse));\n\t\tif (!frm.cur_grid.doc.warehouse) {\n\t\t\tif (printDebug) console.log(__(\"warehouse:\" + frm.doc.default_warehouse));\n\t\t\tfrappe.model.set_value(soi.doctype, soi.name, \"warehouse\", frm.doc.default_warehouse);\n\t\t\t// frm.cur_grid.doc.warehouse = frm.doc.default_warehouse;\n\t\t\t//if (printDebug) console.log(__(\"warehouse:\" + frm.cur_grid.doc.warehouse));\n\t\t\t//refresh_field(\"warehouse\"); \n\t\t}\t\t\n    } */\n\n    if (printDebug) console.log(__(\"END AssignDefaultValues\"));\n}\n\n//////////////////////////// Fin Methodes /////////////////////////////\n///////////////////////// FIN Code specifique /////////////////////////\n///////////////////////////////////////////////////////////////////////\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Item", 
  "modified": "2018-04-02 20:43:39.834152", 
  "name": "Item-Client", 
  "script": "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\n/////////////////////////////// Handles ///////////////////////////////\n\nfrappe.ui.form.on(\"Item\",{\n\tcreer_description_en_lot: function(frm) {\t\n\t\tfrappe.call({\n\t\t\t\"method\": \"radplusplus.radplusplus.controllers.item_variant.make_description_from_template\",\n\t\t\targs: {\n\t\t\t\t\"template\": frm.doc.name\n\t\t\t},\n\t\t\tcallback:function(r){\t\n\t\t\t\tcur_frm.reload_doc();\n\t\t\t\t//refresh_field(\"language\");\n\t\t\t}\n\t\t})\n\t},\n\tcreer_description: function(frm) {\t\n\t\tfrappe.call({\n\t\t\t\"method\": \"radplusplus.radplusplus.controllers.item_variant.regenerate_description_from_item_code\",\n\t\t\targs: {\n\t\t\t\t\"item_code\": frm.doc.name\n\t\t\t},\n\t\t\tcallback:function(r){\t\t\t\n\t\t\t}\n\t\t})\n\t}\n});\n\n// 2016-08-29 - JDLP\n// Permet de remplir le champ configurator_of uniquement avec des items qui sont des \n// modeles.\ncur_frm.fields_dict['configurator_of'].get_query = function(doc) {\n    return {\n        filters: {\n            \"has_variants\": 1\n        }\n    }\n}\n\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Purchase Order", 
  "modified": "2019-03-28 15:42:41.791717", 
  "name": "Purchase Order-Client", 
  "script": "///////////////////////////////////////////////////////////////////////\n/////////////////////////// Code specifique ///////////////////////////\n\n/////////////////////////////// Handles ///////////////////////////////\n\nfrappe.ui.form.on(\"Purchase Order\",{\n\trefresh:  function(frm) {\n\t\tLoadAttributesValues(false, frm, \"items\")\n\t/* \tcur_frm.add_custom_button(__('Update'),\n\t\t\tfunction() {\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod:\"myrador.controllers.status_updater.update_purchase_order_status\",\n\t\t\t\t\tcallback: function(res) {\t\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}, __(\"MAJ\")\n\t\t); */\n\t\t\n\t\tif (cur_frm.doc.docstatus===1) {\n\t\t\tcur_frm.add_custom_button(__('Modifier'),\n\t\t\t\tfunction(frm, doc) {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod:\"myrador.controllers.controllers.change_purchase_order_docstatus\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tdocname: cur_frm.doc.name,\t\t\t\t\t\t\n\t\t\t\t\t\t\tstatus: 0\t\t\t\t\t\t\t\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function(res) {\t\n\t\t\t\t\t\t\tcur_frm.reload_doc();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}, __(\"Modifier\")\n\t\t\t);\n\t\t}\n\t},\n\tsetup : function(frm) {\n\t\tfrm.fields_dict.items.grid.get_field('template').get_query = function() {\n\t\t\treturn erpnext.queries.item({item_group : \"Configurateur\"});\n\t\t};\n\t}\n});\n\nfrappe.ui.form.on(\"Purchase Order Item\",{\n\thistorique_achat : function(frm, cdt, cdn){\n\t\tvar row = locals[cdt][cdn];\t\n\t\tvar item_code = row.item_code\n\t\t\n\t\tvar w = window.open(frappe.urllib.get_full_url(\"/desk#query-report/Item-wise%20Purchase%20History\"));\n\t\tw.focus();\n\n\t\tw.addEventListener('load', function(){\n\t\t  w.frappe.set_route('query-report', 'Item-wise Purchase History', {item: item_code});\n\t\t}, true);\n\t\t\n\t\tif(!w) {\n\t\t\tmsgprint(__(\"Please enable pop-ups\")); return;\n\t\t}  \n\t},\n\ttemplate : function(frm, cdt, cdn){\n\t\tSetConfiguratorOf(false, frm, cdt, cdn)\t\t\n\t},\n\tcreate_variant : function(frm, cdt, cdn) {\n\t\t// Lancer la fonction \"CreateItemVariant\"lorque le bouton \"create_variant\" est active.\n\t\tCreateItemVariant(false, frm, cdt, cdn, true, true)\n\t},\n\treconfigure : function(doc, cdt, cdn) {\n\t\t// Lancer la fonction \"ReconfigurerItemVariant\" lorque le bouton \"reconfigure\" est active.\n\t\tReconfigurerItemVariant(false, doc, cdt, cdn)\n\t},\n\tconfigurator_of : function(frm, cdt, cdn) {\t\n\t\tif (frm.doc.shipper){\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'frappe.client.get_value',\n\t\t\t\targs: {\n\t\t\t\t\t'doctype': 'Customer',\n\t\t\t\t\t'filters': {'name': frm.doc.shipper},\n\t\t\t\t\t'fieldname': [\n\t\t\t\t\t\t'milling'\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc) {\t\n\t\t\t\t\t\tif (r.message.milling) {\n\t\t\t\t\t\t\tShowHideAttributes(false, frm, cdt, cdn, false, true, r.message.milling)\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tShowHideAttributes(false, frm, cdt, cdn, false, true)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\t\t\t\n\t\t}\n\t\telse {\n\t\t\tShowHideAttributes(false, frm, cdt, cdn, false, true)\n\t\t}\n\t},\n\tconstruction : function(frm, cdt, cdn) {\n\t\tvar row = locals[cdt][cdn];\t\t\n\t\tshow_construction(false,row)\n\t}\n});\n///////////////////////////// FIN Handles /////////////////////////////\n\n////////////////////////////// Methodes ///////////////////////////////\n// 2016-10-24 - JDLP\n// Permet d'assigner les valeurs par defaut\nfunction AssignDefaultValues(printDebug, frm, cdt, cdn) {\n\n    var soi = locals[cdt][cdn];\n    if (soi && soi.item_code) {\n        \t\n    }\n\n}\n\n\n//////////////////////////// Fin Methodes /////////////////////////////\n///////////////////////// FIN Code specifique /////////////////////////\n///////////////////////////////////////////////////////////////////////\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Stock Entry", 
  "modified": "2019-02-18 20:48:05.913629", 
  "name": "Stock Entry-Client", 
  "script": "///////////////////////////////////////////////////////////////////////\n/////////////////////////// Code sp\u00e9cifique ///////////////////////////\n/////////////////////////////// Handles ///////////////////////////////\n\t\nvar printDebug = false;\n\nfrappe.ui.form.on(\"Stock Entry\",{\n\tonload : function(frm) {\n\t\tcur_frm.add_fetch(\"shipper\", \"default_warehouse\", \"to_warehouse\");\n\t\tcur_frm.add_fetch(\"shipper\", \"nom_des_lots\", \"prefix\");\n\t\tcur_frm.add_fetch(\"shipper\", \"milling\", \"milling\");\n\t},\n\ton_submit : function(frm) {\n\t\tif (frm.doc.purpose == \"Material Transfer for Manufacture\"){\n\t\t\tfrappe.call({\n\t\t\t\tmethod:\"myrador.controllers.sales_controllers.get_sales_order_item_delivery_info_from_production_order\",\n\t\t\t\targs: {\n\t\t\t\t\tproduction_order: frm.doc.production_order\t\t\t\t\t\t\t\n\t\t\t\t},\n\t\t\t\tcallback: function(res) {\n\t\t\t\t\tif (res.message) {\n\t\t\t\t\t\tif (res.message.sales_order_item) {\n\t\t\t\t\t\t\tconsole.log(res.message.sales_order)\n\t\t\t\t\t\t\tfrappe.prompt([\n\t\t\t\t\t\t\t\t\t{label:__(\"Customer\"), fieldtype:\"Link\", fieldname:\"customer\", options: \"Customer\", read_only:1, default: res.message.customer},\n\t\t\t\t\t\t\t\t\t{label:__(\"Sales Order\"), fieldtype:\"Link\", fieldname:\"sales_order\", options: \"Sales Order\", read_only:1, default: res.message.sales_order},\n\t\t\t\t\t\t\t\t\t{label:__(\"Purchase Order\"), fieldtype:\"Data\", fieldname:\"po_no\", read_only:1, default: res.message.po_no},\n\t\t\t\t\t\t\t\t\t{label:__(\"Qty\"), fieldtype:\"Data\", fieldname:\"qty\", read_only:1, default: res.message.qty},\n\t\t\t\t\t\t\t\t\t{label:__(\"Delivery Date\"), fieldtype:\"Date\", fieldname:\"delivery_date\", reqd: 1, default: res.message.delivery_date},\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t{label:__(\"Firm Order\"), fieldtype:\"Check\", fieldname:\"commande_ferme\", default: res.message.commande_ferme},\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t{label:__(\"Rely on samples\"), fieldtype:\"Check\", fieldname:\"se_fier_sur_echantillons\", default: res.message.se_fier_sur_echantillons},\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t{label:__(\"Sample Received\"), fieldtype:\"Check\", fieldname:\"echantillon_recu\", default: res.message.echantillon_recu}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\tfunction(data) {\n\t\t\t\t\t\t\t\t\tconsole.log(\"Date de livraison : \" + data.delivery_date)\n\t\t\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\t\t\t\"method\": \"frappe.client.set_value\",\n\t\t\t\t\t\t\t\t\t\t\"args\": {\n\t\t\t\t\t\t\t\t\t\t\t//replace \"Target DocType\" with the actual target doctype\n\t\t\t\t\t\t\t\t\t\t\t\"doctype\": \"Sales Order Item\",\n\t\t\t\t\t\t\t\t\t\t\t//replace target_doctype_link with a link to the document to be changed\n\t\t\t\t\t\t\t\t\t\t\t\"name\": res.message.sales_order_item,\n\t\t\t\t\t\t\t\t\t\t\t\"fieldname\": {\n\t\t\t\t\t\t\t\t\t\t\t\t//You can update as many fields as you want.  \n\t\t\t\t\t\t\t\t\t\t\t\t\"delivery_date\": data.delivery_date, \n\t\t\t\t\t\t\t\t\t\t\t\t\"commande_ferme\": data.commande_ferme,\n\t\t\t\t\t\t\t\t\t\t\t\t\"echantillon_recu\": data.echantillon_recu\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t \n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t, __(\"Souhaitez-vous modifier la date de livraison du client?\"), __(\"Termin\u00e9\"));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\trefresh : function(frm) {\n\t\tLoadAttributesValues(false, frm, \"items\")\t\t\t\t\t\n\t\t\n\t\tif (cur_frm.doc.docstatus===1) {\n\t\t\tcur_frm.add_custom_button(__('Modifier'),\n\t\t\t\tfunction(frm, doc) {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod:\"myrador.controllers.controllers.change_stock_entry_docstatus\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tdocname: cur_frm.doc.name,\t\t\t\t\t\t\n\t\t\t\t\t\t\tstatus: 2\t\t\t\t\t\t\t\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function(res) {\t\n\t\t\t\t\t\t\tcur_frm.reload_doc();\n\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\tmethod:\"myrador.controllers.controllers.change_stock_entry_docstatus\",\n\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\tdocname: cur_frm.doc.name,\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tstatus: 0\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcallback: function(res) {\t\n\t\t\t\t\t\t\t\t\tcur_frm.reload_doc();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}, __(\"Modifier\")\n\t\t\t);\n\t\t}\t\n\t},\n\tsetup : function(frm) {\n\t\tfrm.fields_dict.items.grid.get_field('template').get_query = function() {\n\t\t\treturn erpnext.queries.item({item_group : \"Configurateur\"});\n\t\t};\n\t},\n\tshipper: function(frm) {\n\t\t// Retrouver la valeur de language\n\t\tif (frm.doc.shipper){\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.get_value\",\n\t\t\t\targs: {\n\t\t\t\t\t\"doctype\": \"Customer\",\n\t\t\t\t\t\"filters\": {\n\t\t\t\t\t\t\"name\": frm.doc.shipper\n\t\t\t\t\t},\n\t\t\t\t\t\"fieldname\": [\"language\"]\n\t\t\t\t},\n\t\t\t\tcallback: function(res) {\n\t\t\t\t\tcur_frm.set_value('language', res.message.language);\n\t\t\t\t\t// refresh_field(\"language\");\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\ttype_de_reception : function(frm) { // Permet de completer les informations de lot lors du moulurage\n\t\tcur_frm.cscript.toggle_related_fields(cur_frm.doc);\n\t\tif (cur_frm.doc.type_de_reception){\n\t\t\tif (cur_frm.doc.type_de_reception == \"Moulurage\"){\n\t\t\t\tcur_frm.set_value('sequence_lot', 0);\n\t\t\t\tcur_frm.set_value('shipper','');\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: 'frappe.client.get_value',\n\t\t\t\t\targs: {\n\t\t\t\t\t\t'doctype': 'Company',\n\t\t\t\t\t\t'filters': {'name': \"Bois Franc Myrador\"},\n\t\t\t\t\t\t'fieldname': [\n\t\t\t\t\t\t\t'batch_prefix',\n\t\t\t\t\t\t\t'default_milling',\n\t\t\t\t\t\t\t'default_pm_warehouse'\n\t\t\t\t\t\t]\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tif (!r.exc) {\t\n\t\t\t\t\t\t\tif (r.message.batch_prefix) {\n\t\t\t\t\t\t\t\tcur_frm.set_value('prefix', r.message.batch_prefix);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (r.message.default_milling) {\n\t\t\t\t\t\t\t\tcur_frm.set_value('milling', r.message.default_milling);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (r.message.default_pm_warehouse) {\n\t\t\t\t\t\t\t\tcur_frm.set_value('to_warehouse', r.message.default_pm_warehouse);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\t\n\t\t\t}\n\t\t\tif (cur_frm.doc.type_de_reception == \"Plann\u00e9 & D\u00e9lign\u00e9\"){\n\t\t\t\tcur_frm.set_value('sequence_lot', 0);\n\t\t\t\tcur_frm.set_value('shipper','');\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: 'frappe.client.get_value',\n\t\t\t\t\targs: {\n\t\t\t\t\t\t'doctype': 'Company',\n\t\t\t\t\t\t'filters': {'name': \"Bois Franc Myrador\"},\n\t\t\t\t\t\t'fieldname': [\n\t\t\t\t\t\t\t'pb_batch_prefix',\n\t\t\t\t\t\t\t'pb_default_warehouse'\n\t\t\t\t\t\t]\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tif (!r.exc) {\t\n\t\t\t\t\t\t\tif (r.message.pb_batch_prefix) {\n\t\t\t\t\t\t\t\tcur_frm.set_value('prefix', r.message.pb_batch_prefix);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (r.message.pb_default_warehouse) {\n\t\t\t\t\t\t\t\tcur_frm.set_value('to_warehouse', r.message.pb_default_warehouse);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\t\n\t\t\t}\n\t\t\tif (cur_frm.doc.type_de_reception == \"Ajustement d'inventaire\"){\t\t\t\t\n\t\t\t\tcur_frm.set_value('sequence_lot', 0);\n\t\t\t\tcur_frm.set_value('shipper','');\n\t\t\t\tcur_frm.set_value('milling', '');\n\t\t\t\tcur_frm.set_value('prefix', '');\n\t\t\t}\n\t\t\tif (cur_frm.doc.type_de_reception == \"Arrivage\"){\t\t\t\t\n\t\t\t\tcur_frm.set_value('sequence_lot', 0);\n\t\t\t\tcur_frm.set_value('shipper','');\n\t\t\t\tcur_frm.set_value('milling', '');\n\t\t\t\tcur_frm.set_value('prefix', '');\n\t\t\t\tcur_frm.set_value('to_warehouse', '');\n\t\t\t}\n\t\t}\n\t},\n\treserver_la_sequence : function(frm) {\n\t\tfrappe.call({\n\t\t\tmethod:\"myrador.controllers.controllers.get_customer_batch_sequence_and_increment\",\n\t\t\targs: {\n\t\t\t\tcustomer: cur_frm.doc.shipper\n\t\t\t},\n\t\t\tcallback: function(res) {\t\n\t\t\t\tcur_frm.set_value('sequence_lot', res.message);\n\t\t\t}\n\t\t});\n\t},\n\titems_on_form_rendered : function(frm) {\n\t\tconsole.log(\"items_on_form_rendered\")\n\t\tif (cur_frm.doc.docstatus == 0 || cur_frm.doc.__islocal){ \n\t\t\tvar grid_row = cur_frm.open_grid_row();\n\t\t\tvar row = grid_row.grid_form.fields_dict\n\t\t\t\n\t\t\tvar t_warehouse_value = grid_row.grid_form.fields_dict.t_warehouse.value\n\t\t\tif (typeof t_warehouse_value === \"undefined\"){\t\t\n\t\t\t\tgrid_row.grid_form.fields_dict.t_warehouse.set_value(cur_frm.doc.to_warehouse);\t\n\t\t\t}\n\t\t\t\n\t\t\tvar s_warehouse_value = grid_row.grid_form.fields_dict.s_warehouse.value\n\t\t\tif (typeof s_warehouse_value === \"undefined\"){\t\n\t\t\t\tgrid_row.grid_form.fields_dict.s_warehouse.set_value(cur_frm.doc.from_warehouse);\t\n\t\t\t}\n\t\t\t\n\t\t\tvar milling_value = grid_row.grid_form.fields_dict.milling.value\n\t\t\tif (typeof milling_value === \"undefined\"){\t\n\t\t\t\tgrid_row.grid_form.fields_dict.milling.set_value(cur_frm.doc.milling);\n\t\t\t}\n\t\t\t\n\t\t\tvar supplier_value = grid_row.grid_form.fields_dict.source.value\n\t\t\tif (typeof supplier_value === \"undefined\"){\t\n\t\t\t\tgrid_row.grid_form.fields_dict.source.set_value(cur_frm.doc.default_source);\n\t\t\t}\n\t\t\t\n\t\t\tvar prefix_du_lot_value = grid_row.grid_form.fields_dict.prefix_du_lot.value\n\t\t\tif (typeof prefix_du_lot_value === \"undefined\"){\t\n\t\t\t\tgrid_row.grid_form.fields_dict.prefix_du_lot.set_value(cur_frm.doc.prefix);\t\n\t\t\t\tif (printDebug) console.log(__(\"items_on_form_rendered - prefix_du_lot\"));\n\t\t\t}\n\t\t\t\n\t\t\tvar sequence_du_lot_value = grid_row.grid_form.fields_dict.sequence_du_lot.value\n\t\t\tif (typeof sequence_du_lot_value === \"undefined\"){\t\n\t\t\t\tconsole.log(\"sequence_du_lot_value modifie\")\n\t\t\t\tif (cur_frm.doc.type_de_reception == \"Plann\u00e9 & D\u00e9lign\u00e9\"){\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod:\"myrador.controllers.controllers.get_pb_batch_sequence_and_increment\",\n\t\t\t\t\t\tcallback: function(res) {\t\n\t\t\t\t\t\t\tgrid_row.grid_form.fields_dict.sequence_du_lot.set_value(res.message);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tgrid_row.grid_form.fields_dict.sequence_du_lot.set_value(cur_frm.doc.sequence_lot);\t\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tvar id_du_lot_value = grid_row.grid_form.fields_dict.id_du_lot.value\n\t\t\tif (typeof id_du_lot_value === \"undefined\"){\t\t\t\n\t\t\t\tgrid_row.grid_form.fields_dict.id_du_lot.set_value(grid_row.doc.idx);\t\n\t\t\t}\n\t\t\tsetTimeout(function() {\n\t\t\t\tvar grid_row = cur_frm.open_grid_row();\t\t\n\t\t\t\tvar field = grid_row.grid_form.fields_dict.template\n\t\t\t\tset_focus(field);\n\t\t\t}, 800);\n\t\t}\n\t}\t\n});\n\nfrappe.ui.form.on(\"Stock Entry Detail\",{\n\tget_item_from_batch : function(frm,cdt,cdn){\n\t\tvar fields = [\n\t\t\t{'fieldname': 'lot', 'fieldtype': 'Link', 'label': 'Lot', 'options':'Batch'}\n\t\t]\n\t\tvar row = locals[cdt][cdn];\n\t\tvar d = new frappe.ui.Dialog({\n\t\t\ttitle: __('Choisir le lot d\u00e9sir\u00e9'),\n\t\t\tfields: fields,\n\t\t\tprimary_action: function() {\n\t\t\t\tvar data = d.get_values();\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: 'frappe.client.get_value',\n\t\t\t\t\targs: {\n\t\t\t\t\t\t'doctype': 'Batch',\n\t\t\t\t\t\t'filters': {'name': data.lot},\n\t\t\t\t\t\t'fieldname': [\n\t\t\t\t\t\t\t'item'\n\t\t\t\t\t\t]\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tif (!r.exc) {\t\n\t\t\t\t\t\t\tif (r.message.item) {\n\t\t\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name, \"item_code\", r.message.item);\n\t\t\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name, \"batch_no\", data.lot);\n\t\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\t\t\n\t\t\t},\n\t\t\tprimary_action_label: __('Copier le lot')\n\t\t});\n\t\td.show();\n\t},\n\titem_code: function(frm, cdt, cdn) {\n\t\tvar d = locals[cdt][cdn];\n\t\tif(d.item_code) {\n\t\t\tvar args = {\n\t\t\t\t'item_code'\t\t\t: d.item_code,\n\t\t\t\t'warehouse'\t\t\t: cstr(d.s_warehouse) || cstr(d.t_warehouse),\n\t\t\t\t'transfer_qty'\t\t: d.transfer_qty,\n\t\t\t\t'serial_no'\t\t: d.serial_no,\n\t\t\t\t'bom_no'\t\t: d.bom_no,\n\t\t\t\t'expense_account'\t: d.expense_account,\n\t\t\t\t'cost_center'\t\t: d.cost_center,\n\t\t\t\t'company'\t\t: frm.doc.company,\n\t\t\t\t'qty'\t\t\t: d.qty,\n\t\t\t\t'voucher_type'\t\t: frm.doc.doctype,\n\t\t\t\t'voucher_no'\t\t: d.name,\n\t\t\t\t'allow_zero_valuation': 1,\n\t\t\t};\n\t\t\treturn frappe.call({\n\t\t\t\tdoc: frm.doc,\n\t\t\t\tmethod: \"get_item_details\",\n\t\t\t\targs: args,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(r.message) {\n\t\t\t\t\t\tvar d = locals[cdt][cdn];\n\t\t\t\t\t\t$.each(r.message, function(k, v) {\n\t\t\t\t\t\t\td[k] = v;\n\t\t\t\t\t\t});\n\t\t\t\t\t\trefresh_field(\"items\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\tduplicate_row : function(frm,cdt,cdn){\n\t\tif (printDebug) console.log(__(\"duplicate_row\"));\n\t\t\n\t\tvar row = locals[cdt][cdn];\n\t\tvar newrow = frappe.model.add_child(frm.doc, \"Stock Entry Detail\", \"items\");\n\t\tif (typeof row.s_warehouse !== \"undefined\"){\t\t\t\n\t\t\tnewrow.s_warehouse = row.s_warehouse\n\t\t}\n\t\tif (typeof row.t_warehouse !== \"undefined\"){\t\t\t\n\t\t\tnewrow.t_warehouse = row.t_warehouse\n\t\t}\n\t\tnewrow.item_code = row.item_code\t\n\t\tnewrow.item_name = row.item_name\t\n\t\tnewrow.description = row.description\t\n\t\tnewrow.commentaires = row.commentaires\t\t\t\t\t\n\t\tnewrow.qty = row.qty\n\t\tnewrow.qty_per_box = row.qty_per_box\n\t\tif (typeof row.milling !== \"undefined\"){\t\t\t\n\t\t\tnewrow.milling = row.milling\n\t\t}\n\t\tif (typeof row.sequence_du_lot !== \"undefined\" && frm.doc.type_de_reception !== \"Plann\u00e9 & D\u00e9lign\u00e9\"){\t\t\t\n\t\t\tnewrow.sequence_du_lot = row.sequence_du_lot\n\t\t}\n\t\tif (typeof row.prefix_du_lot !== \"undefined\"){\t\t\t\n\t\t\tnewrow.prefix_du_lot = row.prefix_du_lot\n\t\t}\n\t\tif (typeof row.basic_rate !== \"undefined\"){\t\t\t\n\t\t\tnewrow.basic_rate = row.basic_rate\n\t\t}\n\t\tnewrow.uom = row.uom\n\t\tnewrow.conversion_factor = row.conversion_factor\n\t\tnewrow.stock_uom = row.stock_uom\n\t\tnewrow.transfer_qty = row.transfer_qty\n\t\tnewrow.expense_account = row.expense_account\n\t\tnewrow.cost_center = row.cost_center\n\t\tnewrow.allow_zero_valuation_rate = row.allow_zero_valuation_rate\n\t\tnewrow.source = row.source\n\t\t\n\t\tif (printDebug) console.log(__(\"newrow.idx : \" + cstr(newrow.idx)));\n\t\tvar idx = newrow.idx-1;\n\t\t\n\t\trefresh_field(\"items\");\n\t\t\n\t\tcur_frm.get_field(\"items\").grid.grid_rows[idx].toggle_view(true);\n\t\t\n\t\t//cur_frm.refresh()\n\t\t//var grid_row = frappe.ui.form.get_open_grid_form();\n\t\t//grid_row && grid_row.toggle_view(false, function() { grid_row.open_next() });\n\t},\n\tchange_batch_item : function(frm,cdt,cdn){\n\t\tvar row = locals[cdt][cdn];\n\t\t\n\t\tvar dialog = new frappe.ui.Dialog({\n\t\t\t'fields': [\n\t\t\t\t{'fieldname': 'ht', 'fieldtype': 'HTML'},\n\t\t\t\t{'fieldname': 'batch', 'fieldtype': 'Link', 'options': 'Batch', 'label': 'Num\u00e9ro de lot', 'reqd': 1} \n\t\t\t],\n\t\t\tprimary_action: function(){\n\t\t\t\tdialog.hide();\n\t\t\t\tshow_alert(dialog.get_values());\n\t\t\t}\n\t\t});\n\t\tdialog.fields_dict.ht.$wrapper.html('S\u00e9lectionner le num\u00e9ro de lot \u00e0 convertir');\n\t\t\n\t\tdialog.set_primary_action(__(\"Ok\"), function() {\n\t\t\targs = dialog.get_values();\n\t\t\tif(!args) return;\n\t\t\tdialog.hide();\n\t\t\tconsole.log(args.batch)\n\t\t\tfrappe.call({\n\t\t\t\tmethod:\"radplusplus.radplusplus.controllers.stock_controllers.reasign_batch\",\n\t\t\t\targs: {\n\t\t\t\t\titem_code: row.item_code,\t\t\t\t\t\t\n\t\t\t\t\tbatch: args.batch,\n\t\t\t\t\tstock_entry: row.parent\n\t\t\t\t},\n\t\t\t\tcallback: function(res) {\t\t\t\t\t\n\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name, 'batch_no', args.batch);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\t\n\t\tdialog.show();\n\t},\n\ttemplate : function(frm, cdt, cdn){\n\t\tSetConfiguratorOf(false, frm, cdt, cdn)\t\t\n\t},\n\tcreate_variant : function(frm, cdt, cdn) {\n\t\tCreateItemVariant(false, frm, cdt, cdn, true, true)\n\t},\n\treconfigure : function(doc, cdt, cdn) {\n\t\tReconfigurerItemVariant(false, doc, cdt, cdn)\n\t},\n\tconfigurator_of : function(frm, cdt, cdn) {\t\n\t\tShowHideAttributes(false, frm, cdt, cdn, false, true)\n\t},\n\tt_warehouse : function(doc, cdt, cdn) {\n\t\tif (printDebug) console.log(__(\"t_warehouse\"));\n\t\tvar row = locals[cdt][cdn];\n\t\tvar me = this;\t\t\n\t\tif (cur_frm.doc.type_de_reception) {\n\t\t\tif (cur_frm.doc.type_de_reception == \"Arrivage\") {\n\t\t\t\tfrappe.model.set_value(row.doctype, row.name, 'allow_zero_valuation_rate', 1);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfrappe.model.set_value(row.doctype, row.name, 'allow_zero_valuation_rate', 0);\n\t\t\t}\t\t\t\t\t\t\n\t\t\tAssignBatchInfo(true, cur_frm, cdt, cdn)\n\t\t}\n\t},\n\ts_warehouse : function(doc, cdt, cdn) {\n\t\tif (printDebug) console.log(__(\"s_warehouse\"));\n\t\tvar row = locals[cdt][cdn];\n\t\tvar me = this;\t\t\n\t\tif (cur_frm.doc.purpose == \"Material Transfer for Manufacture\") {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'frappe.client.get_value',\n\t\t\t\targs: {\n\t\t\t\t\t'doctype': 'Warehouse',\n\t\t\t\t\t'filters': {'name': row.s_warehouse},\n\t\t\t\t\t'fieldname': [\n\t\t\t\t\t\t'is_customer_warehouse'\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc) {\t\t\t\t\t\n\t\t\t\t\t\tif (r.message.is_customer_warehouse) {\n\t\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name, 'allow_zero_valuation_rate', r.message.is_customer_warehouse);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name, 'allow_zero_valuation_rate', 0);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tif (cur_frm.doc.type_de_reception) {\n\t\t\tif (cur_frm.doc.type_de_reception == \"Arrivage\") {\n\t\t\t\tfrappe.model.set_value(row.doctype, row.name, 'allow_zero_valuation_rate', 1);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfrappe.model.set_value(row.doctype, row.name, 'allow_zero_valuation_rate', 0);\n\t\t\t}\t\t\t\t\t\t\n\t\t\tAssignBatchInfo(true, cur_frm, cdt, cdn)\n\t\t}\n\t},\n\titems_add: function(doc, cdt, cdn) {\n\t\tif (printDebug) console.log(__(\"items_add\"));\n\t\t\n\t\tvar row = frappe.get_doc(cdt, cdn);\n\t\tvar me = this;\t\t\n\t\tcur_frm.script_manager.copy_from_first_row(\"items\", row, [\"expense_account\", \"cost_center\"]);\n\n\t\tif(!row.s_warehouse && cur_frm.doc.from_warehouse) row.s_warehouse = cur_frm.doc.from_warehouse;\n\t\tif(!row.t_warehouse && cur_frm.doc.to_warehouse) row.t_warehouse = cur_frm.doc.to_warehouse;\n\t\t\t\n\t\tvar row = locals[cdt][cdn];\n\t\tif (printDebug) console.log(__(\"avant frappe.call\"));\n\t\t\n\t\tif (cur_frm.doc.purpose == \"Material Transfer for Manufacture\") {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'frappe.client.get_value',\n\t\t\t\targs: {\n\t\t\t\t\t'doctype': 'Warehouse',\n\t\t\t\t\t'filters': {'name': row.s_warehouse},\n\t\t\t\t\t'fieldname': [\n\t\t\t\t\t\t'is_customer_warehouse'\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\t\n\t\t\t\t\tif (printDebug) console.log(__(\"CALLBACK item_add Transfer\"));\t\t\t\t\t\t\n\t\t\t\t\tif (!r.exc) {\t\n\t\t\t\t\t\tif (r.message.is_customer_warehouse) {\n\t\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name, 'allow_zero_valuation_rate', r.message.is_customer_warehouse);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name, 'allow_zero_valuation_rate', 0);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tif (cur_frm.doc.type_de_reception) {\n\t\t\tif (cur_frm.doc.type_de_reception == \"Arrivage\") {\n\t\t\t\tfrappe.model.set_value(row.doctype, row.name, 'allow_zero_valuation_rate', 1);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfrappe.model.set_value(row.doctype, row.name, 'allow_zero_valuation_rate', 0);\n\t\t\t}\t\t\t\t\t\t\n\t\t\tAssignBatchInfo(false, cur_frm, cdt, cdn)\n\t\t}\n\t},\n\tcreer_le_lot : function(doc, cdt, cdn) {\n\t\tif (printDebug) console.log(__(\"creer_le_lot\"));\n\t\tvar row = locals[cdt][cdn];\n\t\tvar me = this;\t\t\n\t\tif (!row.item_code) frappe.msgbox(\"\")\n\t\tfrappe.call({\n\t\t\tmethod:\"myrador.controllers.controllers.create_batch_number\",\n\t\t\targs: {\n\t\t\t\ttype_de_reception: cur_frm.doc.type_de_reception,\n\t\t\t\titem: row.item_code,\n\t\t\t\tprefix: row.prefix_du_lot,\n\t\t\t\tsequence: row.sequence_du_lot,\n\t\t\t\tid: row.id_du_lot\n\t\t\t},\n\t\t\tcallback: function(res) {\n\t\t\t\tif (!res.exc) {\n\t\t\t\t\tif (res.message.lot_cree == 1){\n\t\t\t\t\t\tconsole.log(\"res.message.lot_cree = 1\")\n\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name, 'batch_no', res.message.batch_number);\n\t\t\t\t\t\trefresh_field(\"batch_no\");\n\t\t\t\t\t}\n\t\t\t\t\telse{\n\t\t\t\t\t\tconsole.log(\"frappe.confirm\")\n\t\t\t\t\t\tfrappe.confirm(\n\t\t\t\t\t\t\t'Le lot existe d\u00e9j\u00e0. Voulez-vous tenter le remplacer?',\n\t\t\t\t\t\t\tfunction(){\n\t\t\t\t\t\t\t\tconsole.log(\"window.close()\")\n\t\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\t\tmethod:\"radplusplus.radplusplus.controllers.stock_controllers.reasign_batch\",\n\t\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\t\titem_code: row.item_code,\n\t\t\t\t\t\t\t\t\t\tbatch: res.message.batch_number,\n\t\t\t\t\t\t\t\t\t\tstock_entry: row.parent\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tfreeze: true,\n\t\t\t\t\t\t\t\t\tfreeze_message: __(\"Please wait ...\"),\n\t\t\t\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t\t\t\t\t\tconsole.log(\"callback\")\n\t\t\t\t\t\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name, 'batch_no', res.message.batch_number);\n\t\t\t\t\t\t\t\t\t\t\trefresh_field(\"batch_no\");\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfunction(){\n\t\t\t\t\t\t\t\tshow_alert(\"Le lot n'a pas \u00e9t\u00e9 remplac\u00e9.\")\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}); \n\n///////////////////////////// FIN Handles /////////////////////////////\n\n////////////////////////////// M\u00e9thodes ///////////////////////////////\n\n// 2017-09-13 - RENMAI\n// Script fonctionnel\n// Permet d'assigner les valeurs par d\u00e9faut des lots a une ligne donnee.\nfunction AssignBatchInfo(printDebug, frm, cdt, cdn) {\n    if (printDebug) console.log(__(\"AssignBatchInfo\"));\n\t\n\tvar row = locals[cdt][cdn];\n    \n\tvar type_entree = [\"Arrivage\",\"Moulurage\", \"Plann\u00e9 & D\u00e9lign\u00e9\"] \n\tif (type_entree.indexOf(frm.doc.type_de_reception) >= 0 ){\n\t\tif (frm.doc.milling && row.milling == \"\"){\n\t\t\tfrappe.model.set_value(row.doctype, row.name, 'milling', frm.doc.milling);\n\t\t}\n\t\tif (frm.doc.default_source && row.source == \"\"){\n\t\t\tfrappe.model.set_value(row.doctype, row.name, 'source', frm.doc.default_source);\n\t\t}\n\t\tif (frm.doc.prefix && row.prefix_du_lot == \"\"){\n\t\t\tfrappe.model.set_value(row.doctype, row.name, 'prefix_du_lot', frm.doc.prefix);\n\t\t\tif (printDebug) console.log(__(\"AssignBatchInfo - prefix_du_lot\"));\n\t\t}\n\t\tif (frm.doc.sequence_lot && row.sequence_du_lot == 0){\n\t\t\tfrappe.model.set_value(row.doctype, row.name, 'sequence_du_lot', frm.doc.sequence_lot);\n\t\t}\t\n\t}\n}\n\n// 2017-09-13 - RENMAI\n// Script fonctionnel\n// Permet de copier la valeur d'un champ dans le champs correspondant d'un ligne donnee.\nfunction copy_field(printDebug, source, target,) {\n    if (printDebug) console.log(__(\"copy_field\"));\n\t\n\t\n    if (printDebug) console.log(typeof source);\n\t\n\tif (typeof source !== \"undefined\"){\t\t\t\n\t\ttarget = source\n\t}\n}\n\n// 2016-10-24 - JDLP\n// Script fonctionnel\n// Permet d'assigner les valeurs par d\u00e9faut\n// Ce script doit etre present dans tous les doc utilisant le configurateur\nfunction AssignDefaultValues(printDebug, frm, cdt, cdn) {\n    if (printDebug) console.log(__(\"AssignDefaultValues\"));\n    if (printDebug) console.log(__(\"Debug mode ON\"));\n\n    var soi = locals[cdt][cdn];\n    if (soi && soi.item_code) {\n\t\t// 2016-11-02 - JDLP - \n        StockEntryDetailOnItemChange(printDebug, frm, cdt, cdn);\n    }\n    if (printDebug) console.log(__(\"END AssignDefaultValues\"));\n}\n\n// 2016-11-22 - JDLP\n// J'ai d\u00e9plac\u00e9 le code de \"erpnext\\stock\\doctype\\stock_entry\\stock_entry.js\" \"cur_frm.cscript.item_code\"\n// Ceci rentrait en conflit avec le configurateur\nfunction StockEntryDetailOnItemChange(printDebug, frm, cdt, cdn){\n\tprintDebug = true;\n\tif (printDebug) console.log(__(\"StockEntryDetailOnItemChange\"));\n\tvar d = locals[cdt][cdn];\t\t\t\n\tif(d.item_code) {\n\t\targs = {\n\t\t\t'item_code'\t\t\t: d.item_code,\n\t\t\t'warehouse'\t\t\t: cstr(d.s_warehouse) || cstr(d.t_warehouse),\n\t\t\t'transfer_qty'\t\t: d.transfer_qty,\n\t\t\t'serial_no\t'\t\t: d.serial_no,\n\t\t\t'bom_no'\t\t\t: d.bom_no,\n\t\t\t'expense_account'\t: d.expense_account,\n\t\t\t'cost_center'\t\t: d.cost_center,\n\t\t\t'company'\t\t\t: cur_frm.doc.company\n\t\t};\n\t\treturn frappe.call({\n\t\t\tdoc: cur_frm.doc,\n\t\t\tmethod: \"get_item_details\",\n\t\t\targs: args,\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.message) {\n\t\t\t\t\tvar d = locals[cdt][cdn];\n\t\t\t\t\t$.each(r.message, function(k, v) {\n\t\t\t\t\t\td[k] = v;\n\t\t\t\t\t});\n\t\t\t\t\trefresh_field(\"items\");\n\t\t\t\t\tSetVariantOf(true, frm, cdt, cdn, true, false)\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\t\n}\n//////////////////////////// Fin M\u00e9thodes /////////////////////////////\n///////////////////////// FIN Code sp\u00e9cifique /////////////////////////\n///////////////////////////////////////////////////////////////////////\n\n// Overloaded query for link batch_no\ncur_frm.fields_dict['items'].grid.get_field('batch_no').get_query = function(doc, cdt, cdn) {\n\tvar item = locals[cdt][cdn];\n\tconsole.log(\"Overloaded query for link batch_no\")\n\tif(!item.item_code) {\n\t\tfrappe.throw(__(\"Please enter Item Code to get batch no\"));\n\t}\n\telse {\n\t\tif (in_list([\"Material Transfer for Manufacture\", \"Manufacture\", \"Repack\", \"Subcontract\"], doc.purpose)) {\n\t\t\tvar filters = {\n\t\t\t\t'item_code': item.item_code,\n\t\t\t\t'posting_date': me.frm.doc.posting_date || nowdate()\n\t\t\t}\n\t\t} else {\n\t\t\tvar filters = {\n\t\t\t\t'item_code': item.item_code\n\t\t\t}\n\t\t}\n\n\n\t\tif(item.s_warehouse) filters[\"warehouse\"] = item.s_warehouse\n\t\treturn {\n\t\t\tquery : \"myrador.controllers.queries.get_batch_no\",\n\t\t\tfilters: filters\n\t\t}\n\t}\n}\n\n\n// Overide de la m\u00e9thode toggle_related_fields par RAD++\n// Permet d'ajouter un entrep\u00f4t source pour la consommation du non-moulur\u00e9 lors de la r\u00e9ception du moulurage.\n// 2018-10-16\n\ncur_frm.cscript.toggle_related_fields = function(doc) {\n\tthis.frm.toggle_enable(\"from_warehouse\", doc.purpose!='Material Receipt' || doc.type_de_reception=='Moulurage');\n\tthis.frm.toggle_enable(\"to_warehouse\", doc.purpose!='Material Issue');\n\tthis.frm.fields_dict[\"items\"].grid.set_column_disp(\"s_warehouse\", doc.purpose!='Material Receipt' || doc.type_de_reception=='Moulurage');\n\tthis.frm.fields_dict[\"items\"].grid.set_column_disp(\"t_warehouse\", doc.purpose!='Material Issue');\n\tthis.frm.fields_dict[\"items\"].grid.set_column_disp(\"retain_sample\", doc.purpose=='Material Receipt');\n\tthis.frm.fields_dict[\"items\"].grid.set_column_disp(\"sample_quantity\", doc.purpose=='Material Receipt');\n\n\tthis.frm.cscript.toggle_enable_bom();\n\n\tif (doc.purpose == 'Subcontract') {\n\t\tdoc.customer = doc.customer_name = doc.customer_address =\n\t\t\tdoc.delivery_note_no = doc.sales_invoice_no = null;\n\t} else {\n\t\tdoc.customer = doc.customer_name = doc.customer_address =\n\t\t\tdoc.delivery_note_no = doc.sales_invoice_no = doc.supplier =\n\t\t\tdoc.supplier_name = doc.supplier_address = doc.purchase_receipt_no =\n\t\t\tdoc.address_display = null;\n\t}\n\tif(doc.purpose == \"Material Receipt\") {\n\t\tthis.frm.set_value(\"from_bom\", 0);\n\t}\n\n\t// Addition costs based on purpose\n\tthis.frm.toggle_display([\"additional_costs\", \"total_additional_costs\", \"additional_costs_section\"],\n\t\tdoc.purpose!='Material Issue');\n\n\tthis.frm.fields_dict[\"items\"].grid.set_column_disp(\"additional_cost\", doc.purpose!='Material Issue');\n}\n\n// Overide de la m\u00e9thode select_batch_and_serial_no par RAD++\n// Permet \u00e0 l'entrep\u00f4t par d\u00e9faut de s'afficher dans la msgbox s\u00e9lection des lots, selon les entrep\u00f4ts disponible dans la ligne du Stock Entry.\n// 2018-10-16\nerpnext.stock.select_batch_and_serial_no = (frm, item) => {\n\tlet get_warehouse_type_and_name = (item) => {\n\t\tlet value = '';\n\t\tif(item.s_warehouse) {\n\t\t\tvalue = cstr(item.s_warehouse) || '';\n\t\t\treturn {\n\t\t\t\ttype: 'Source Warehouse',\n\t\t\t\tname: value\n\t\t\t};\n\t\t} else {\n\t\t\tvalue = cstr(item.t_warehouse) || '';\n\t\t\treturn {\n\t\t\t\ttype: 'Target Warehouse',\n\t\t\t\tname: value\n\t\t\t};\n\t\t}\n\t}\n\n\tif(item && item.has_serial_no\n\t\t&& frm.doc.purpose === 'Material Receipt') {\n\t\treturn;\n\t}\n\t\n\t/* if(item && item.has_batch_no && frm.doc.purpose === 'Material Receipt' && frm.doc.type_de_reception=='Moulurage' && !item.s_warehouse && item.t_warehouse) {\n\t\treturn;\n\t} */\n\n\tfrappe.require(\"assets/erpnext/js/utils/serial_no_batch_selector.js\", function() {\n\t\tnew erpnext.SerialNoBatchSelector({\n\t\t\tfrm: frm,\n\t\t\titem: item,\n\t\t\twarehouse_details: get_warehouse_type_and_name(item),\n\t\t});\n\t});\n\n}\n\n// Overide de la m\u00e9thode set_warehouse_if_different par RAD++\n// Permet de limiter la modification des entrep\u00f4ts de la table item par les entrep\u00f4ts par d\u00e9fauts. \n// Les entrep\u00f4ts sont modifi\u00e9s uniquement si aucune valeur n'est pr\u00e9sente lors de la s\u00e9lection des entrep\u00f4ts par d\u00e9faut.\n// 2018-10-16\n\ncur_frm.cscript.set_warehouse_if_different = function(fieldname, value, condition) {\n\tvar changed = false;\n\tfor (var i=0, l=(this.frm.doc.items || []).length; i<l; i++) {\n\t\tvar row = this.frm.doc.items[i];\n\t\tif (!row[fieldname]) {\n\t\t\tif (condition && !condition(row)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tfrappe.model.set_value(row.doctype, row.name, fieldname, value, \"Link\");\n\t\t\tchanged = true;\n\t\t}\n\t}\n\trefresh_field(\"items\");\n}\t", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Configurator Batch", 
  "modified": "2017-06-17 16:29:00.437697", 
  "name": "Configurator Batch-Client", 
  "script": "cur_frm.fields_dict['configurator_of'].get_query = function(doc) {\n    return {\n        filters: {\n            \"has_configuration\": 1\n        }\n    }\n}\n\nfrappe.ui.form.on(\"Configurator Batch\", \"validate\", function(doc, cdt, cdn) {\n\t//valider que tous les attributs on au moins une valeur de coche\n});\n\nfrappe.ui.form.on(\"Configurator Batch\", \"make_variants\", function(frm, cdt, cdn) {\n\tfrappe.call({\n\t\tmethod: \"erpnext.controllers.item_variant.CreateBatchVariants\",\n\t\targs: {\n\t\t\t\"batch_name\": frm.doc.name,\n\t\t\t\"configurator_of\": frm.doc.configurator_of,\n\t\t},\n\t\tcallback: function(res) {\n\t\t\t//Convertir le message en Array\n\t\t\tvar variants = (res.message || []);\n\t\t\t\n\t\t\tmsgprint(\"Les pi\u00e8ces ont \u00e9t\u00e9 cr\u00e9es.\");\n\t\t\t\t\n\t\t\tfrm.timeline.insert_comment(\"Comment\", variants);\n\t\t\t\n\t\t}\n\t});\n});\n\nfrappe.ui.form.on(\"Configurator Batch\", \"add_attributes\", function(doc, cdt, cdn) {\n\t//Retrouver les attribut qui s'appliquent\n\tfrappe.call({\n\t\tmethod: \"erpnext.controllers.item_variant.GetItemAttributesValues\",\n\t\targs: {\"item_code\": doc.fields_dict.configurator_of.value},\n\t\tcallback: function(res) {\n\t\t\t//Convertir le message en Array\n\t\t\tvar attributes = (res.message || []);\n\t\t\tconsole.log(__(\"cur_frm.doc.item_attribute_values.length :\" + cur_frm.doc.item_attribute_values.length));\n\t\t\t\n\t\t\t//pour chaque field \n\t\t\tfor (var k = 0; k < cur_frm.doc.item_attribute_values.length; k++) {\n\t\t\t\tvar row = cur_frm.doc.item_attribute_values[k];\n\t\t\t\t\n\t\n\t\t\t\tvar found = false;\t\n\t\t\t\t\n\t\t\t\t//pour chaque attribut\n\t\t\t\tfor (var j = 0; j < attributes.length; j++) {\n\t\t\t\t\t//Pointeur sur grid\n\t\t\t\t\tconsole.log(__(\"Row : \" + row.attribute_name + \":\" + row.item_attribute_value));\n\t\t\t\t\tconsole.log(__(\"Attributes : \" + attributes[j][0] + \":\" + attributes[j][1]));\n\t\t\t\t\tconsole.log(__(\"found : \" + found));\n\t\t\t\t\t\n\t\t\t\t\tif (row.attribute_name == attributes[j][0] && row.item_attribute_value == attributes[j][1] ) {\n\t\t\t\t\t\tconsole.log(__(\"Match *****\"));\n\t\t\t\t\t\tattributes.splice(j,1);\n\t\t\t\t\t\tfound = true;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (found){\n\t\t\t\t\t\tconsole.log(__(\"Sortie de boucle attributes \"));\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\t\t\t\n\t\t\tconsole.log(__(\"attributes.length :\" + attributes.length));\n\t\t\t\n\t\t\tfor (var j = 0; j < attributes.length; j++) {\n\t\t\t\tvar new_row = frappe.model.add_child(cur_frm.doc, \"Configurator Batch Attribute\", \"item_attribute_values\");\n\t\t\t\tnew_row.attribute_name = attributes[j][0];\n\t\t\t\tnew_row.item_attribute_value = attributes[j][1];\n\t\t\t\tnew_row.selected = false;\n\t\t\t}\n\t\t\t\n\t\t\trefresh_field(\"item_attribute_values\");\n\t\t}\n\t});\n});\n\nfrappe.ui.form.on(\"Configurator Batch\", \"configurator_of\", function(doc, cdt, cdn) {\n\t//Retrouver les attribut qui s'appliquent\n\tfrappe.call({\n\t\tmethod: \"erpnext.controllers.item_variant.GetItemAttributesValues\",\n\t\targs: {\"item_code\": doc.fields_dict.configurator_of.value},\n\t\tcallback: function(res) {\n\t\t\t//Convertir le message en Array\n\t\t\tvar attributes = (res.message || []);\n\t\t\t\n\t\t\t//effacer\n\t\t\t\n\t\t\t//pour chaque attribut\n\t\t\tfor (var j = 0; j < attributes.length; j++) {\n\t\t\t\tvar new_row = frappe.model.add_child(cur_frm.doc, \"Configurator Batch Attribute\", \"item_attribute_values\");\n\t\t\t\tnew_row.attribute_name = attributes[j][0];\n\t\t\t\tnew_row.item_attribute_value = attributes[j][1];\n\t\t\t\tnew_row.selected = false;\n\t\t\t}\n\t\t\t\n\t\t\trefresh_field(\"item_attribute_values\");\n\t\t}\n\t});\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Variant Price List", 
  "modified": "2018-04-02 20:41:12.207066", 
  "name": "Variant Price List-Client", 
  "script": "// Copyright (c) 2016, RAD plus plus inc. and contributors\n// For license information, please see license.txt\n\n///////////////////////////////////////////////////////////////////////\n/////////////////////////// Code specifique ///////////////////////////\n\n/////////////////////////////// Handles ///////////////////////////////\n\nfrappe.ui.form.on('Variant Price List', {\n\tonload: function(frm) {\n\n\t},\n\trefresh: function(frm) {\n\t\t// 2016-10-17 - JDLP\n\t\t// Lancer la fonction \"LoadAttributesValues\" au \"onLoad\" du formulaire parent.\t\n\t\tLoadAttributesValues(false, frm, \"variants\")\n\t}\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Opportunity", 
  "modified": "2018-04-02 20:44:09.004717", 
  "name": "Opportunity-Client", 
  "script": "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\n/////////////////////////////// Handles ///////////////////////////////\n\nfrappe.ui.form.on(\"Opportunity\",{\n\trefresh : function(frm) {\t\n\t\tLoadAttributesValues(false, frm, \"items\")\n\t},\n\tsetup : function(frm) {\n\t\tfrm.fields_dict.items.grid.get_field('template').get_query = function() {\n\t\t\treturn erpnext.queries.item({item_group : \"Configurateur\"});\n\t\t};\n\t},\n\titems_on_form_rendered : function(frm) {\n\t\tsetTimeout(function() {\n\t\t\tvar grid_row = cur_frm.open_grid_row();\t\t\n\t\t\tvar field = grid_row.grid_form.fields_dict.template\n\t\t\tset_focus(field);\n\t\t}, 800);\n\t}\n});\n\nfrappe.ui.form.on(\"Opportunity Item\",{\n\ttemplate : function(frm, cdt, cdn){\n\t\tSetConfiguratorOf(false, frm, cdt, cdn)\t\t\n\t},\n\tcreate_variant : function(frm, cdt, cdn) {\n\t\t// Lancer la fonction \"CreateItemVariant\"lorque le bouton \"create_variant\" est active.\n\t\tCreateItemVariant(true, frm, cdt, cdn, true, true)\n\t},\n\treconfigure : function(doc, cdt, cdn) {\n\t\t// Lancer la fonction \"ReconfigurerItemVariant\" lorque le bouton \"reconfigure\" est active.\n\t\tReconfigurerItemVariant(false, doc, cdt, cdn)\n\t},\n\tconfigurator_of : function(frm, cdt, cdn) {\t\n\t\tif (frm.doc.shipper){\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'frappe.client.get_value',\n\t\t\t\targs: {\n\t\t\t\t\t'doctype': 'Customer',\n\t\t\t\t\t'filters': {'name': frm.doc.shipper},\n\t\t\t\t\t'fieldname': [\n\t\t\t\t\t\t'milling'\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc) {\t\n\t\t\t\t\t\tif (r.message.milling) {\n\t\t\t\t\t\t\tShowHideAttributes(false, frm, cdt, cdn, false, true, r.message.milling)\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tShowHideAttributes(false, frm, cdt, cdn, false, true)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\t\t\t\n\t\t}\n\t\telse {\n\t\t\tShowHideAttributes(false, frm, cdt, cdn, false, true)\n\t\t}\n\t}, \n\tconstruction : function(frm, cdt, cdn) {\n\t\tvar row = locals[cdt][cdn];\t\t\n\t\tif (row.construction == \"Massif\"){\n\t\t\tfrappe.model.set_value(row.doctype, row.name, 'thickness', '3/4\"');\n\t\t\tfrappe.model.set_value(row.doctype, row.name, 'length', \"1' a\u0300 7'\");\n\t\t}\n\t\tif (row.construction == \"Hardwood\"){\n\t\t\tfrappe.model.set_value(row.doctype, row.name, 'thickness', '3/4\"');\n\t\t\tfrappe.model.set_value(row.doctype, row.name, 'length', \"1' to 7'\");\n\t\t}\n\t\tif (row.construction.toString().substring(0,10) == \"Ing\u00e9nierie\" ){\n\t\t\tfrappe.model.set_value(row.doctype, row.name, 'thickness', __('5/8\"'));\n\t\t\tfrappe.model.set_value(row.doctype, row.name, 'length', \"1' a\u0300 8'\");\n\t\t}\n\t\tif (row.construction.toString().substring(0,10) == \"Engineered\"){\n\t\t\tfrappe.model.set_value(row.doctype, row.name, 'thickness', '5/8\"');\n\t\t\tfrappe.model.set_value(row.doctype, row.name, 'length', '1\\' to 8\\'');\n\t\t}\n\t}\n});\n\n\t\n///////////////////////////// FIN Handles /////////////////////////////\n///////////////////////////////////////////////////////////////////////\n\n/////////////////////////////////////////////////////////////////////\n/////////////////////////// Code specifique ///////////////////////////\n\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Production Order", 
  "modified": "2019-02-20 20:41:36.770942", 
  "name": "Production Order-Client", 
  "script": "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\n/////////////////////////////// Handles ///////////////////////////////\nfrappe.ui.form.on(\"Production Order\",{\n\trefresh: function(frm) {\n\t\tconsole.log(\"refresh\");\n\t\tfrm.toggle_display(\"options_de_production\", cur_frm.doc.sales_order_item);\n\t\tfrm.toggle_display(\"ligne_de_vente\", cur_frm.doc.sales_order_item);\n\t\tfrm.toggle_display(\"po_no\", cur_frm.doc.sales_order_item);\n\t\tfrm.toggle_display(\"customer\", cur_frm.doc.sales_order_item);\n\t\t\n\t\tif (cur_frm.doc.sales_order_item){\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'frappe.client.get_value',\n\t\t\t\targs: {\n\t\t\t\t\t'doctype': 'Sales Order Item',\n\t\t\t\t\t'filters': {'name': cur_frm.doc.sales_order_item},\n\t\t\t\t\t'fieldname': [\n\t\t\t\t\t\t'se_fier_sur_echantillons',\n\t\t\t\t\t\t'echantillon_recu',\n\t\t\t\t\t\t'quantite_ferme',\n\t\t\t\t\t\t'commande_ferme',\n\t\t\t\t\t\t'commentaire_production',\n\t\t\t\t\t\t'idx'\n\t\t\t\t\t],\n\t\t\t\t\t'parent':'Sales Order'\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc) {\t\n\t\t\t\t\t\tvar options_fabrications = \"\";\n\t\t\t\t\t\tconsole.log(\"options_fabrications\"); \n\t\t\t\t\t\tif (r.message.se_fier_sur_echantillons) {\n\t\t\t\t\t\t\toptions_fabrications =  options_fabrications + \" - Se fier sur \u00e9chantillon. <br>\" ;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (r.message.echantillon_recu) {\n\t\t\t\t\t\t\toptions_fabrications =  options_fabrications + \" - \u00c9chantillon re\u00e7u. <br>\" ;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (r.message.quantite_ferme) {\n\t\t\t\t\t\t\toptions_fabrications =  options_fabrications + \" - Quantit\u00e9 ferme : \" + r.message.quantite_ferme.toString() + \"<br>\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (r.message.commande_ferme) {\n\t\t\t\t\t\t\toptions_fabrications =  options_fabrications + \" - Commande ferme. <br>\" ;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (r.message.commentaire_production) {\n\t\t\t\t\t\t\toptions_fabrications =  options_fabrications + \" - \" + r.message.commentaire_production;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar template = \"<div>Commentaires de commande de vente <BR> <B>{{ data }}</B></div>\";\n\t\t\t\t\t\tfrm.set_df_property('options_de_production', 'options', frappe.render(template, {data: options_fabrications}));\n\t\t\t\t\t\t\t\n\t\t\t\t\t\tif (r.message.idx) {\n\t\t\t\t\t\t\tvar template = `\n\t\t\t\t\t\t\t<div class=\"form-group\">\t\n\t\t\t\t\t\t\t\t<div class=\"clearfix\">\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<label class=\"control-label\" style=\"padding-right: 0px;\">{{ titre }}</label>\n\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\n\t\t\t\t\t\t\t\t<div class=\"control-input-wrapper\">\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<div class=\"control-input\" style=\"display: none;\">\n\t\t\t\t\t\t\t\t\t</div>\t\n\t\t\t\t\t\t\t\t\t<div class=\"control-value like-disabled-input\" style=\"\">\n\t\t\t\t\t\t\t\t\t\t<a class=\"grey\" href=\"{{ href }}\" data-doctype=\"Sales%20Order\">{{ data }}</a>\n\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<p class=\"help-box small text-muted hidden-xs\">\n\t\t\t\t\t\t\t\t\t</p>\t\t\t\t\t\n\t\t\t\t\t\t\t\t</div>\t\t\t\t\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t//var template = \"<div>Num\u00e9ro de commande client <BR> <B>{{ data }}</B></div>\";\n\t\t\t\t\t\t\tfrm.set_df_property(\"ligne_de_vente\", \"options\", frappe.render(template, {href : \"#Form/Sales%20Order/\" + cur_frm.doc.sales_order, titre : __(\"Sales Order Line\"), data: r.message.idx}));\n\t\t\t\t\t\t\tfrm.refresh_field('ligne_de_vente');\t\n\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\tconsole.log(\"callback\"); \n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t});\t\n\t\t\t\n\t\t\t// Affiche le boutton qui permet de delier un OF.\n\t\t\tif (cur_frm.doc.docstatus===0) {\n\t\t\t\tcur_frm.add_custom_button(__(\"D\u00e9lier la commande de vente\"),\n\t\t\t\t\tfunction(frm) {\n\t\t\t\t\t\tcur_frm.set_value('sales_order', \"\");\n\t\t\t\t\t\tcur_frm.set_value('sales_order_item', \"\");\n\t\t\t\t\t\tcur_frm.refresh();\n\t\t\t\t\t}, __(\"Modifier\")\n\t\t\t\t);\n\t\t\t}\t\n\t\t}\t\t\n\t\telse {\n\t\t\t// Affiche le boutton qui permet de relier un OF.\n\t\t\tif (cur_frm.doc.docstatus===0) {\n\t\t\t\tcur_frm.add_custom_button(__('Relier une commande de vente'),\n\t\t\t\t\tfunction(frm) {\n\t\t\t\t\t\tvar fields = [\n\t\t\t\t\t\t\t{fieldtype:'Link', fieldname:'sales_order', options: 'Sales Order', reqd: 1,\n\t\t\t\t\t\t\t\tlabel: __('S\u00e9lectionner la commande de vente'), get_query: function() {\n\t\t\t\t\t\t\t\t\treturn {filters: {docstatus: 1}};\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t]\n\t\t\t\t\t\tvar d = new frappe.ui.Dialog({\n\t\t\t\t\t\t\ttitle: __('S\u00e9lectionner la commande de vente'),\n\t\t\t\t\t\t\tfields: fields,\n\t\t\t\t\t\t\tprimary_action: function() {\n\t\t\t\t\t\t\t\tvar data_so = d.get_values();\t\t\n\t\t\t\t\t\t\t\tconsole.log(\"ads\")\n\t\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\t\tmethod:\"radplusplus.radplusplus.controllers.manufacturing_controllers.get_sales_order_item_description\",\n\t\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\t\t\"sales_order\": data_so.sales_order,\n\t\t\t\t\t\t\t\t\t\t\"production_item\":cur_frm.doc.production_item\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t\t\t\t\t\tvar fields_soi = [\n\t\t\t\t\t\t\t\t\t\t\t\t{fieldtype:\"Select\", label: __(\"Lignes du {0} possible \u00e0 lier\", [data_so.sales_order]), fieldname:\"sales_order_item\",\toptions:r.message, description:\"Attention - le code de l'article doit \u00eatre le m\u00eame dans la commande de vente et dans l'ordre de fabrication. Si aucune information n'est affich\u00e9e dans la liste c'est qu'aucun code ne concordent.\" }\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t\tvar dia_soi = new frappe.ui.Dialog({\n\t\t\t\t\t\t\t\t\t\t\t\ttitle: __('S\u00e9lectionner la ligne de commande de vente'),\n\t\t\t\t\t\t\t\t\t\t\t\tfields: fields_soi,\n\t\t\t\t\t\t\t\t\t\t\t\tprimary_action: function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar data_soi = dia_soi.get_values();\n\t\t\t\t\t\t\t\t\t\t\t\t\tif(data_soi.sales_order_item) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttuple = dia_soi.fields[0].options.find(x => x.value === data_soi.sales_order_item)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcur_frm.set_value('sales_order', data_so.sales_order);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcur_frm.set_value('sales_order_item', tuple.key);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcur_frm.refresh();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdia_soi.hide();\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\tprimary_action_label: __('Ok')\n\t\t\t\t\t\t\t\t\t\t\t});\t\t\t\n\t\t\t\t\t\t\t\t\t\t\tdia_soi.show();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tprimary_action_label: __('Ok')\n\t\t\t\t\t\t});\n\t\t\t\t\t\td.show();\n\t\t\t\t\t}, __(\"Modifier\")\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\t\n\t\tif (cur_frm.doc.sales_order){\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'frappe.client.get_value',\n\t\t\t\targs: {\n\t\t\t\t\t'doctype': 'Sales Order',\n\t\t\t\t\t'filters': {'name': cur_frm.doc.sales_order},\n\t\t\t\t\t'fieldname': [\n\t\t\t\t\t\t'po_no',\n\t\t\t\t\t\t'customer'\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc) {\t\n\t\t\t\t\t\tif (r.message.po_no) {\n\t\t\t\t\t\t\tvar template = `\n\t\t\t\t\t\t\t<div class=\"form-group\">\t\n\t\t\t\t\t\t\t\t<div class=\"clearfix\">\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<label class=\"control-label\" style=\"padding-right: 0px;\">{{ titre }}</label>\n\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\n\t\t\t\t\t\t\t\t<div class=\"control-input-wrapper\">\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<div class=\"control-input\" style=\"display: none;\">\n\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<div class=\"control-value like-disabled-input\" style=\"\">\n\t\t\t\t\t\t\t\t\t\t<a class=\"grey\" href=\"{{ href }}\" data-doctype=\"Sales%20Order\">{{ data }}</a>\n\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<p class=\"help-box small text-muted hidden-xs\">\n\t\t\t\t\t\t\t\t\t</p>\t\t\t\t\t\n\t\t\t\t\t\t\t\t</div>\t\t\t\t\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t//var template = \"<div>Num\u00e9ro de commande client <BR> <B>{{ data }}</B></div>\";\n\t\t\t\t\t\t\tfrm.set_df_property(\"po_no\", \"options\", frappe.render(template, {href : \"#Form/Sales%20Order/\" + cur_frm.doc.sales_order,titre : __(\"Customer's Purchase Order\"), data: r.message.po_no}));\n\t\t\t\t\t\t\tfrm.refresh_field('po_no');\t\n\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\tif (r.message.customer) {\n\t\t\t\t\t\t\tvar template = `\n\t\t\t\t\t\t\t<div class=\"form-group\">\t\n\t\t\t\t\t\t\t\t<div class=\"clearfix\">\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<label class=\"control-label\" style=\"padding-right: 0px;\">{{ titre }}</label>\n\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\n\t\t\t\t\t\t\t\t<div class=\"control-input-wrapper\">\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<div class=\"control-input\" style=\"display: none;\">\n\t\t\t\t\t\t\t\t\t</div>\t\n\t\t\t\t\t\t\t\t\t<div class=\"control-value like-disabled-input\" style=\"\">\n\t\t\t\t\t\t\t\t\t\t<a class=\"grey\" href=\"{{ href }}\" data-doctype=\"Customer\">{{ data }}</a>\n\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<p class=\"help-box small text-muted hidden-xs\">\n\t\t\t\t\t\t\t\t\t</p>\t\t\t\t\t\n\t\t\t\t\t\t\t\t</div>\t\t\t\t\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t//var template = \"<div>Num\u00e9ro de commande client <BR> <B>{{ data }}</B></div>\";\n\t\t\t\t\t\t\tfrm.set_df_property(\"customer\", \"options\", frappe.render(template, {href : \"#Form/Customer/\" + r.message.customer, titre : __(\"Customer\"), data: r.message.customer}));\n\t\t\t\t\t\t\tfrm.refresh_field('customer');\t\n\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\tconsole.log(\"if (cur_frm.doc.sales_order) --- callback\"); \n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t});\t\n\t\t}\n\t\t\n\t\tif (cur_frm.doc.docstatus === 1) {\n\t\t\tif (cur_frm.doc.status != 'Stopped' && cur_frm.doc.status != 'Completed') {\n\t\t\t\tfrm.add_custom_button(__('Purchase Order'), function() {\n\t\t\t\t\terpnext.production_order.make_purchase_order();\n\t\t\t\t}, __(\"Make\"));\n\t\t\t}\n\t\t}\n\t\t\n\t\tif (cur_frm.doc.docstatus===1) {\n\t\t\tcur_frm.add_custom_button(__('Modifier'),\n\t\t\t\tfunction(frm, doc) {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod:\"myrador.controllers.controllers.change_production_order_docstatus\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tdocname: cur_frm.doc.name,\t\t\t\t\t\t\n\t\t\t\t\t\t\tstatus: 0\t\t\t\t\t\t\t\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function(res) {\t\n\t\t\t\t\t\t\tcur_frm.reload_doc();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}, __(\"Modifier\")\n\t\t\t);\n\t\t}\t\n\t\t\n\t\tif (cur_frm.doc.docstatus != 2) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'frappe.client.get_value',\n\t\t\t\targs: {\n\t\t\t\t\t'doctype': 'Item Variant Attribute',\n\t\t\t\t\t'filters': {'parent': cur_frm.doc.production_item, 'attribute':\"Color\"},\n\t\t\t\t\t'fieldname': [\n\t\t\t\t\t\t'attribute_value'\n\t\t\t\t\t],\n\t\t\t\t\t'parent':'Item'\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc) {\t\n\t\t\t\t\t\tif (r.message){\n\t\t\t\t\t\t\tif (r.message.attribute_value &&  r.message.attribute_value == \"Transparent - (000)\") {\n\t\t\t\t\t\t\t\tcur_frm.set_value('teinture_produite', 1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\t\t\t\t\t\t\t\n\t\t\t\t\t}\t\t\n\t\t\t\t}\n\t\t\t});\t\n\t\t\t\n\t\t\tfrappe.call({ \n\t\t\t\tmethod:\"radplusplus.radplusplus.controllers.manufacturing_controllers.update_reserved_qty\",\n\t\t\t\targs:{\n\t\t\t\t\tproduction_order: cur_frm.doc.name\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc) {\t\n\t\t\t\t\t\tif (r.message && r.message != cur_frm.doc.material_transferred_for_manufacturing) {\n\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\t\"method\": \"frappe.client.set_value\",\n\t\t\t\t\t\t\t\t\"args\": {\n\t\t\t\t\t\t\t\t\t\"doctype\": \"Production Order\",\n\t\t\t\t\t\t\t\t\t\"name\": frm.doc.name,\n\t\t\t\t\t\t\t\t\t\"fieldname\": {\n\t\t\t\t\t\t\t\t\t\t\"material_transferred_for_manufacturing\": r.message\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\t\t\t\t\t\t\t\t \n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t\n\t},\n\tbom_no: function(frm) {\n\t\tif (cur_frm.doc.status != \"Not Started\" && !cur_frm.doc.__islocal){\n\t\t\tfrappe.msgprint(\"Un nouveau BOM a \u00e9t\u00e9 s\u00e9lectionn\u00e9 alors que l'ordre de fabrication est d\u00e9marr\u00e9. Les mat\u00e9riaux et les op\u00e9rations n'ont pas \u00e9t\u00e9 modifi\u00e9. Veuillez vous assurer que les mat\u00e9riaux et les op\u00e9rations sont conforment \u00e0 la nouvelle production.\",\"Attention\");\n\t\t}\n\t\telse {\n\t\t\tconsole.log(\"bom_no else\");\n\t\t\treturn frm.call({\n\t\t\t\tdoc: frm.doc,\n\t\t\t\tmethod: \"get_items_and_operations_from_bom\",\n\t\t\t\tfreeze: true,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(r.message[\"set_scrap_wh_mandatory\"]){\n\t\t\t\t\t\tfrm.toggle_reqd(\"scrap_warehouse\", true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\timport_description: function(frm) {\n\t\tfrappe.call({ \n\t\t\tmethod:\"myrador.controllers.sales_controllers.get_sales_orders_item_divers_description\",\n\t\t\targs:{\n\t\t\t\tsales_order: cur_frm.doc.generic_sales_order\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif (!r.exc) {\t\n\t\t\t\t\tif (r.message ) {\n\t\t\t\t\t\tfrm.set_value(\"commentaires_ordonnancement\", r.message);\n\t\t\t\t\t\tfrm.set_value(\"commentaires\", r.message);\n\t\t\t\t\t}\t\t\t\t\t\t\t\t \n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n});\n\t\nerpnext.production_order.set_default_warehouse = function(frm) {\n\tif (!(frm.doc.wip_warehouse || frm.doc.fg_warehouse || frm.doc.source_warehouse)) {\n\t\tconsole.log(\"IF\");\n\t\tfrappe.call({\n\t\t\tmethod: \"radplusplus.radplusplus.controllers.manufacturing_controllers.get_default_warehouse\",\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exe) {\n\t\t\t\t\tconsole.log(\"callback\");\n\t\t\t\t\tfrm.set_value(\"wip_warehouse\", r.message.wip_warehouse);\n\t\t\t\t\tfrm.set_value(\"fg_warehouse\", r.message.fg_warehouse);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n\nerpnext.production_order.stop_production_order = function(frm, status) {\n\tfrappe.call({\n\t\tmethod: \"erpnext.manufacturing.doctype.production_order.production_order.stop_unstop\",\n\t\targs: {\n\t\t\tproduction_order: frm.doc.name,\n\t\t\tstatus: status\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tif(r.message) {\n\t\t\t\tfrm.set_value(\"status\", r.message);\n\t\t\t\tfrm.reload_doc();\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"myrador.myrador.doctype.production_order_operation_scheduler.production_order_operation_scheduler.make_from_production_order\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tproduction_order: frm.doc.name\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t})\n}\n\nerpnext.production_order.make_purchase_order = function(frm, purpose) {\n\tvar me = this;\n\tfrappe.call({\n\t\tmethod: 'radplusplus.radplusplus.controllers.manufacturing_controllers.get_purchase_order_items',\n\t\targs: {\n\t\t\tself: cur_frm.doc\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tif(!r.message) {\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\ttitle: __('Purchase Order not created'),\n\t\t\t\t\tmessage: __('No Items to Purchase'),\n\t\t\t\t\tindicator: 'orange'\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\t\t\telse if(!r.message) {\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\ttitle: __('Purchase Order not created'),\n\t\t\t\t\tmessage: __('Purchase Order already created for all required items'),\n\t\t\t\t\tindicator: 'orange'\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tvar fields = [\n\t\t\t\t\t{fieldtype:'Table', fieldname: 'items',\n\t\t\t\t\t\tdescription: __(\"S\u00e9lectionner le fournisseur et la date requise pour les commandes d'achat\"),\n\t\t\t\t\t\tfields: [\n\t\t\t\t\t\t\t{fieldtype:'Read Only', fieldname:'item_code',\n\t\t\t\t\t\t\t\tlabel: __('Item Code'), in_list_view:1},\n\t\t\t\t\t\t\t{fieldtype:'Link', fieldname:'supplier', options: 'Supplier', reqd: 1,\n\t\t\t\t\t\t\t\tlabel: __('Fournisseur'), in_list_view:1},\n\t\t\t\t\t\t\t{fieldtype:'Data', fieldname:'warehouse', reqd: 1,\n\t\t\t\t\t\t\t\tlabel: __('Entrep\u00f4ts'), hidden:1},\n\t\t\t\t\t\t\t{fieldtype:'Date', fieldname:'required_date', reqd: 1,\n\t\t\t\t\t\t\t\tlabel: __('Date requise'), in_list_view:1},\n\t\t\t\t\t\t\t{fieldtype:'Float', fieldname:'pending_qty', reqd: 1,\n\t\t\t\t\t\t\t\tlabel: __('Qty'), in_list_view:1},\n\t\t\t\t\t\t\t{fieldtype:'Data', fieldname:'production_order_item', reqd: 1,\n\t\t\t\t\t\t\t\tlabel: __('Production Order Item'), hidden:1}\n\t\t\t\t\t\t],\n\t\t\t\t\t\tget_data: function() {\n\t\t\t\t\t\t\treturn r.message\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t\tvar d = new frappe.ui.Dialog({\n\t\t\t\t\ttitle: __('Conserver les items que vous d\u00e9sirez commander.'),\n\t\t\t\t\tfields: fields,\n\t\t\t\t\tprimary_action: function() {\n\t\t\t\t\t\tvar data = d.get_values();\n\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\tmethod: 'radplusplus.radplusplus.controllers.manufacturing_controllers.make_purchase_orders',\n\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\titems: data,\n\t\t\t\t\t\t\t\tcompany: cur_frm.doc.company,\n\t\t\t\t\t\t\t\tproduction_order: cur_frm.doc.name,\n\t\t\t\t\t\t\t\tproject: cur_frm.project\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfreeze: true,\n\t\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\t\tif(r.message) {\n\t\t\t\t\t\t\t\t\tfrappe.msgprint({\n\t\t\t\t\t\t\t\t\t\tmessage: __(\"Commande d'achat cr\u00e9\u00e9 : {0}\",\n\t\t\t\t\t\t\t\t\t\t\t[r.message.map(function(d) {\n\t\t\t\t\t\t\t\t\t\t\t\treturn repl('<a href=\"#Form/Purchase Order/%(name)s\">%(name)s</a>', {name:d})\n\t\t\t\t\t\t\t\t\t\t\t}).join(', ')]),\n\t\t\t\t\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tprimary_action_label: __('Cr\u00e9er')\n\t\t\t\t});\n\t\t\t\td.show();\n\t\t\t}\n\t\t}\n\t});\n}\n\nerpnext.production_order.make_se = function(frm, purpose) {\n\tvar me = this;\n\tfrappe.call({\n\t\tmethod: \"frappe.client.get_value\",\n\t\targs: {\n\t\t\t\"doctype\": \"Manufacturing Settings\",\n\t\t\t\"filters\": \"\",\n\t\t\t\"fieldname\": \"over_production_allowance_percentage\"\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tif (!r.exc) {\t\n\t\t\t\tvar allowance_percentage = r.message.over_production_allowance_percentage ? r.message.over_production_allowance_percentage : 100;\n\t\t\t\tvar max = (purpose === \"Manufacture\") ?\n\t\t\t\t\tflt(allowance_percentage/100 * frm.doc.qty) - flt(frm.doc.produced_qty) :\n\t\t\t\t\tflt(allowance_percentage/100 * frm.doc.qty) - flt(frm.doc.material_transferred_for_manufacturing);\n\t\t\t\tvar balance_qty = (purpose === \"Manufacture\") ?\n\t\t\t\t\tflt(frm.doc.material_transferred_for_manufacturing) - flt(frm.doc.produced_qty) :\n\t\t\t\t\tflt(frm.doc.qty) - flt(frm.doc.material_transferred_for_manufacturing);\n\n\t\t\t\tfrappe.prompt({fieldtype:\"Float\", label: __(\"Qty for {0}\", [purpose]), fieldname:\"qty\",\n\t\t\t\t\tdescription: __(\"Max: {0}\", [max]), 'default': balance_qty },\n\t\t\t\t\tfunction(data) {\n\t\t\t\t\t\tif(data.qty > max) {\n\t\t\t\t\t\t\tfrappe.msgprint(__(\"Quantity must not be more than {0}\", [max]));\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\tmethod:\"erpnext.manufacturing.doctype.production_order.production_order.make_stock_entry\",\n\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\"production_order_id\": frm.doc.name,\n\t\t\t\t\t\t\t\t\"purpose\": purpose,\n\t\t\t\t\t\t\t\t\"qty\": data.qty\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\t\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}, __(\"Select Quantity\"), __(\"Make\"));\n\t\t\t}\n\t\t\telse {\n\t\t\t\tconsole.log(\"ELSE !r.exc\")\n\t\t\t}\n\t\t}\n\t});\n}\n\nerpnext.production_order.bom_no = function(frm) {\n\tif (cur_frm.doc.status != \"Not Started\"){\n\t\tmsgprint(\"Un nouveau BOM a \u00e9t\u00e9 s\u00e9lectionn\u00e9 alors que l'ordre de fabrication est d\u00e9marr\u00e9. Les mat\u00e9riaux et les op\u00e9rations n'ont pas \u00e9t\u00e9 modifi\u00e9. Veuillez vous assurer que les mat\u00e9riaux et les op\u00e9rations sont conforment \u00e0 la nouvelle production.\",\"Attention\")\n\t}\n\telse {\n\t\treturn frm.call({\n\t\t\tdoc: frm.doc,\n\t\t\tmethod: \"get_items_and_operations_from_bom\",\n\t\t\tfreeze: true,\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.message[\"set_scrap_wh_mandatory\"]){\n\t\t\t\t\tfrm.toggle_reqd(\"scrap_warehouse\", true);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\t\n}\n\t\n$.extend(cur_frm.cscript, {\n\tmake_se: function(purpose) {\n\t\tvar me = this;\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.client.get_value\",\n\t\t\targs: {\n\t\t\t\t\"doctype\": \"Manufacturing Settings\",\n\t\t\t\t\"filters\": \"\",\n\t\t\t\t\"fieldname\": \"over_production_allowance_percentage\"\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif (!r.exc) {\t\n\t\t\t\t\tvar allowance_percentage = r.message.over_production_allowance_percentage ? r.message.over_production_allowance_percentage : 100;\n\t\t\t\t\tvar max = (purpose === \"Manufacture\") ?\n\t\t\t\t\t\tflt(allowance_percentage/100 * me.frm.doc.qty) - flt(me.frm.doc.produced_qty) :\n\t\t\t\t\t\tflt(allowance_percentage/100 * me.frm.doc.qty) - flt(me.frm.doc.material_transferred_for_manufacturing);\n\t\t\t\t\tvar balance_qty = (purpose === \"Manufacture\") ?\n\t\t\t\t\t\tflt(me.frm.doc.material_transferred_for_manufacturing) - flt(me.frm.doc.produced_qty) :\n\t\t\t\t\t\tflt(me.frm.doc.qty) - flt(me.frm.doc.material_transferred_for_manufacturing);\n\n\t\t\t\t\tfrappe.prompt({fieldtype:\"Float\", label: __(\"Qty for {0}\", [purpose]), fieldname:\"qty\",\n\t\t\t\t\t\tdescription: __(\"Max: {0}\", [max]), 'default': balance_qty },\n\t\t\t\t\t\tfunction(data) {\n\t\t\t\t\t\t\tif(data.qty > max) {\n\t\t\t\t\t\t\t\tfrappe.msgprint(__(\"Quantity must not be more than {0}\", [max]));\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\tmethod:\"erpnext.manufacturing.doctype.production_order.production_order.make_stock_entry\",\n\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\t\"production_order_id\": me.frm.doc.name,\n\t\t\t\t\t\t\t\t\t\"purpose\": purpose,\n\t\t\t\t\t\t\t\t\t\"qty\": data.qty\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\t\t\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}, __(\"Select Quantity\"), __(\"Make\"));\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tconsole.log(\"ELSE !r.exc\")\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\t/*,\n\n\tqty: function() {\n\t\tupdate_details();\n\t}  */\n});\n\nfunction update_details() {\n\tconsole.log(\"Update_Details\")\n    frappe.call({\n\t\tmethod:\"radplusplus.radplusplus.controllers.manufacturing_controllers.update_details\",\n\t\targs: {\n\t\t\t\"self\": cur_frm.doc\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tfrappe.model.sync(r.message);\n\t\t\tcur_frm.refresh();\n\t\t\tconsole.log(\"cur_frm.refresh\")\t\t\t\n\t\t}\n\t});\n}\n\t\t\t\t\t\t\t", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "BOM", 
  "modified": "2018-04-02 20:44:21.376141", 
  "name": "BOM-Client", 
  "script": "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\n/////////////////////////////// Handles ///////////////////////////////\n\nfrappe.ui.form.on(\"BOM Operation\",{\n\t\"operation\": function(frm, cdt, cdn) {\t\n\t\tvar d = locals[cdt][cdn];\n\n\t\tif(!d.operation) return;\n\n\t\tfrappe.call({\n\t\t\t\"method\": \"frappe.client.get\",\n\t\t\targs: {\n\t\t\t\tdoctype: \"Operation\",\n\t\t\t\tname: d.operation\n\t\t\t},\n\t\t\tcallback: function (data) {\n\t\t\t\tif(data.message.description) {\n\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, \"description\", data.message.description);\n\t\t\t\t}\n\t\t\t\tif(data.message.workstation) {\n\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, \"workstation\", data.message.workstation);\n\t\t\t\t}\n\t\t\t\tfrappe.model.set_value(d.doctype, d.name, \"no_oper\", d.idx *10);\t\t\t\n\t\t\t\t//msgprint(\"d : \" + d.idx);\n\t\t\t}\n\t\t})\n\t}\n});\n\nfrappe.ui.form.on(\"BOM Item\",{\n\t\"item_code\": function(frm, cdt, cdn) {\t\n\t\tvar d = locals[cdt][cdn];\n\n\t\tif(!d.item_code) return;\n\n\t\tfrappe.model.set_value(d.doctype, d.name, \"no_mtl\", d.idx *10);\n\t}\n});\n\n\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Material Request", 
  "modified": "2018-04-02 20:43:55.957175", 
  "name": "Material Request-Client", 
  "script": "// Copyright (c) 2016, RAD plus plus inc. and contributors\n// For license information, please see license.txt\n\n/////////////////////////////// Handles ///////////////////////////////\n\nfrappe.ui.form.on(\"Material Request\",{\n\trefresh : function(frm) {\n\t\tLoadAttributesValues(false, frm, \"items\")\n\t},\n\tsetup : function(frm) {\n\t\tfrm.fields_dict.items.grid.get_field('template').get_query = function() {\n\t\t\treturn erpnext.queries.item({item_group : \"Configurateur\"});\n\t\t};\n\t},\n\titems_on_form_rendered : function(frm) {\n\t\tsetTimeout(function() {\n\t\t\tvar grid_row = cur_frm.open_grid_row();\t\t\n\t\t\tvar field = grid_row.grid_form.fields_dict.template\n\t\t\tset_focus(field);\n\t\t}, 800);\n\t}\n});\n\nfrappe.ui.form.on(\"Material Request Item\",{\n\ttemplate : function(frm, cdt, cdn){\n\t\tSetConfiguratorOf(false, frm, cdt, cdn)\t\t\n\t},\n\tcreate_variant : function(frm, cdt, cdn) {\n\t\t// Lancer la fonction \"CreateItemVariant\"lorque le bouton \"create_variant\" est active.\n\t\tCreateItemVariant(false, frm, cdt, cdn, true, true)\n\t},\n\treconfigure : function(doc, cdt, cdn) {\n\t\t// Lancer la fonction \"ReconfigurerItemVariant\" lorque le bouton \"reconfigure\" est active.\n\t\tReconfigurerItemVariant(false, doc, cdt, cdn)\n\t},\n\tconfigurator_of : function(frm, cdt, cdn) {\t\n\t\tif (frm.doc.shipper){\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'frappe.client.get_value',\n\t\t\t\targs: {\n\t\t\t\t\t'doctype': 'Customer',\n\t\t\t\t\t'filters': {'name': frm.doc.shipper},\n\t\t\t\t\t'fieldname': [\n\t\t\t\t\t\t'milling'\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc) {\t\n\t\t\t\t\t\tif (r.message.milling) {\n\t\t\t\t\t\t\tShowHideAttributes(false, frm, cdt, cdn, false, true, r.message.milling)\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tShowHideAttributes(false, frm, cdt, cdn, false, true)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\t\t\t\n\t\t}\n\t\telse {\n\t\t\tShowHideAttributes(false, frm, cdt, cdn, false, true)\n\t\t}\n\t},\n\tconstruction : function(frm, cdt, cdn) {\n\t\tvar row = locals[cdt][cdn];\t\t\n\t\tif (row.construction == \"Massif\"){\n\t\t\tfrappe.model.set_value(row.doctype, row.name, 'thickness', '3/4\"');\n\t\t\tfrappe.model.set_value(row.doctype, row.name, 'length', \"1' a\u0300 7'\");\n\t\t}\n\t\tif (row.construction == \"Hardwood\"){\n\t\t\tfrappe.model.set_value(row.doctype, row.name, 'thickness', '3/4\"');\n\t\t\tfrappe.model.set_value(row.doctype, row.name, 'length', \"1' to 7'\");\n\t\t}\n\t\tif (row.construction.toString().substring(0,10) == \"Ing\u00e9nierie\" ){\n\t\t\tfrappe.model.set_value(row.doctype, row.name, 'thickness', __('5/8\"'));\n\t\t\tfrappe.model.set_value(row.doctype, row.name, 'length', \"1' a\u0300 8'\");\n\t\t}\n\t\tif (row.construction.toString().substring(0,10) == \"Engineered\"){\n\t\t\tfrappe.model.set_value(row.doctype, row.name, 'thickness', '5/8\"');\n\t\t\tfrappe.model.set_value(row.doctype, row.name, 'length', '1\\' to 8\\'');\n\t\t}\n\t}\n});\n\n\t\n///////////////////////////// FIN Handles /////////////////////////////\n///////////////////////////////////////////////////////////////////////\n\n/////////////////////////////////////////////////////////////////////\n/////////////////////////// Code specifique ///////////////////////////\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Purchase Receipt", 
  "modified": "2018-06-11 10:44:12.277282", 
  "name": "Purchase Receipt-Client", 
  "script": "///////////////////////////////////////////////////////////////////////\n/////////////////////////// Code specifique ///////////////////////////\n/////////////////////////////// Handles ///////////////////////////////\n\t\nvar printDebug = true;\n\nfrappe.ui.form.on(\"Purchase Receipt\",{\n\tonload : function(frm) {\n\t\tcur_frm.add_fetch(\"supplier\", \"milling\", \"milling\");\n\t\tcur_frm.add_fetch(\"supplier\", \"prefix\", \"prefix\");\n\t\tcur_frm.add_fetch(\"supplier\", \"est_fournisseur_de_moulure\", \"is_mp_supplier\");\n\t},\n\trefresh : function(frm){\t\n\t\tLoadAttributesValues(false, frm, \"items\")\n\t\tif (cur_frm.doc.supplier){\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'frappe.client.get_value',\n\t\t\t\targs: {\n\t\t\t\t\t'doctype': 'Supplier',\n\t\t\t\t\t'filters': {'name': cur_frm.doc.supplier},\n\t\t\t\t\t'fieldname': [\n\t\t\t\t\t\t'prefix',\n\t\t\t\t\t\t'milling',\n\t\t\t\t\t\t'est_fournisseur_de_moulure'\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc) {\t\t\t\t\t\n\t\t\t\t\t\tif (r.message.prefix) {\n\t\t\t\t\t\t\tcur_frm.set_value('prefix', r.message.prefix);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (r.message.milling) {\n\t\t\t\t\t\t\tcur_frm.set_value('milling', r.message.milling);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (r.message.est_fournisseur_de_moulure) {\n\t\t\t\t\t\t\tcur_frm.set_value('is_mp_supplier', r.message.est_fournisseur_de_moulure);\n\t\t\t\t\t\t}\t\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tcur_frm.add_custom_button(__('Update'),\n\t\t\tfunction() {\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod:\"myrador.controllers.status_updater.update_purchase_receipt_status\",\n\t\t\t\t\tcallback: function(res) {\t\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}, __(\"MAJ\")\n\t\t);\n\t},\n\treserver_la_sequence : function(frm) {\n\t\tfrappe.call({\n\t\t\tmethod:\"myrador.controllers.controllers.get_company_batch_sequence_and_increment\",\n\t\t\targs: {\n\t\t\t\tself: cur_frm.doc\n\t\t\t},\n\t\t\tcallback: function(res) {\t\n\t\t\t\tcur_frm.set_value('sequence_lot', res.message);\n\t\t\t}\n\t\t});\n\t},\n\titems_on_form_rendered : function(frm) {\n\t\tvar grid_row = cur_frm.open_grid_row();\n\t\tvar row = grid_row.grid_form.fields_dict\n\t\t\n\t\tvar milling_value = grid_row.grid_form.fields_dict.milling.value\n\t\tif (typeof milling_value === \"undefined\"){\t\n\t\t\tgrid_row.grid_form.fields_dict.milling.set_value(cur_frm.doc.milling);\n\t\t}\n\t\t\n\t\tvar prefix_du_lot_value = grid_row.grid_form.fields_dict.prefix_du_lot.value\n\t\tif (typeof prefix_du_lot_value === \"undefined\"){\t\n\t\t\tgrid_row.grid_form.fields_dict.prefix_du_lot.set_value(cur_frm.doc.prefix);\t\n\t\t}\n\t\t\n\t\tvar sequence_du_lot_value = grid_row.grid_form.fields_dict.sequence_du_lot.value\n\t\tif (typeof sequence_du_lot_value === \"undefined\" || sequence_du_lot_value == 0){\t\n\t\t\tgrid_row.grid_form.fields_dict.sequence_du_lot.set_value(cur_frm.doc.sequence_lot);\t\n\t\t}\n\t\t\n\t\tvar id_du_lot_value = grid_row.grid_form.fields_dict.id_du_lot.value\n\t\tif (typeof id_du_lot_value === \"undefined\" || id_du_lot_value == 0){\t\t\t\n\t\t\tgrid_row.grid_form.fields_dict.id_du_lot.set_value(grid_row.doc.idx);\t\n\t\t}\n\t},\n\tsupplier : function(frm){\t\n\t\tvar milling_change_log = false;\n\t\tif (cur_frm.doc.milling){\n\t\t\t$.each(me.frm.doc.items || [], function(i, d) {\n\t\t\t\td.milling = cur_frm.doc.milling;\n\t\t\t\tmilling_change_log = true;\t\t\t\n\t\t\t});\t\n\t\t\tif (milling_change_log) frappe.msgprint(__(\"Le moulurage de chaque article de ce document est maintenant {0}\", [cur_frm.doc.milling]));\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'frappe.client.get_value',\n\t\t\t\targs: {\n\t\t\t\t\t'doctype': 'Supplier',\n\t\t\t\t\t'filters': {'name': cur_frm.doc.supplier},\n\t\t\t\t\t'fieldname': [\n\t\t\t\t\t\t'prefix'\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc) {\t\t\t\t\t\n\t\t\t\t\t\tif (r.message.prefix) {\n\t\t\t\t\t\t\tcur_frm.doc.prefix = r.message.prefix;\n\t\t\t\t\t\t\trefresh_field(\"prefix\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t} \n});\n\nfrappe.ui.form.on(\"Purchase Receipt Item\",{\n\tduplicate_row : function(frm,cdt,cdn){\n\t\tvar row = locals[cdt][cdn];\n\t\tvar newrow = frappe.model.add_child(frm.doc, \"Purchase Receipt Item\", \"items\");\n\t\tif (typeof row.t_warehouse !== \"undefined\"){\t\t\t\n\t\t\tnewrow.s_warehouse = row.s_warehouse\n\t\t}\n\t\tif (typeof row.t_warehouse !== \"undefined\"){\t\t\t\n\t\t\tnewrow.t_warehouse = row.t_warehouse\n\t\t}\n\t\tnewrow.item_code = row.item_code\t\n\t\tnewrow.item_name = row.item_name\t\n\t\tnewrow.description = row.description\t\n\t\tnewrow.commentaires = row.commentaires\t\t\t\t\t\n\t\tnewrow.qty = row.qty\n\t\tnewrow.qty_per_box = row.qty_per_box\n\t\tif (typeof row.milling !== \"undefined\"){\t\t\t\n\t\t\tnewrow.milling = row.milling\n\t\t}\n\t\tif (typeof row.sequence_du_lot !== \"undefined\"){\t\t\t\n\t\t\tnewrow.sequence_du_lot = row.sequence_du_lot\n\t\t}\n\t\tif (typeof row.prefix_du_lot !== \"undefined\"){\t\t\t\n\t\t\tnewrow.prefix_du_lot = row.prefix_du_lot\n\t\t}\n\t\tnewrow.purchase_order = row.purchase_order\n\t\tnewrow.purchase_order_item = row.purchase_order_item\n\t\tif (typeof row.rate !== \"undefined\"){\t\t\t\n\t\t\tnewrow.rate = row.rate\n\t\t}\n\t\tnewrow.uom = row.uom\n\t\tnewrow.conversion_factor = row.conversion_factor\n\t\tnewrow.stock_uom = row.stock_uom\n\t\tnewrow.base_account = row.base_account\n\t\tnewrow.cost_center = row.cost_center\n\t\tnewrow.is_sample_item = row.is_sample_item\n\t\t\n\t\tcur_frm.refresh()\n\t\tvar grid_row = frappe.ui.form.get_open_grid_form();\n\t\tgrid_row && grid_row.toggle_view(false, function() { grid_row.open_next() });\n\t},\n\titems_add: function(doc, cdt, cdn) {\n\t\tAssignBatchInfo(true, cur_frm, cdt, cdn)\n\t},\n\tcreer_le_lot : function(doc, cdt, cdn) {\n\t\tvar row = locals[cdt][cdn];\n\t\tvar me = this;\t\t\n\t\tif (!row.item_code) frappe.msgbox(\"Select Item\")\n\t\tfrappe.call({\n\t\t\tmethod:\"myrador.controllers.controllers.create_batch_number\",\n\t\t\targs: {\n\t\t\t\ttype_de_reception: \"Purchase Receipt\",\n\t\t\t\titem: row.item_code,\n\t\t\t\tprefix: row.prefix_du_lot,\n\t\t\t\tsequence: row.sequence_du_lot,\n\t\t\t\tid: row.id_du_lot\n\t\t\t},\n\t\t\tcallback: function(res) {\t\t\n\t\t\t\tif (!res.exc) {\n\t\t\t\t\tif (res.message.lot_cree == 1){\n\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name, 'batch_no', res.message.batch_number);\n\t\t\t\t\t\trefresh_field(\"batch_no\");\n\t\t\t\t\t}\n\t\t\t\t\telse{\n\t\t\t\t\t\tfrappe.confirm(\n\t\t\t\t\t\t\t'Batch already exist. Do you want to replace it?',\n\t\t\t\t\t\t\tfunction(){\n\t\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\t\tmethod:\"radplusplus.radplusplus.controllers.stock_controllers.reasign_batch\",\n\t\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\t\titem_code: row.item_code,\n\t\t\t\t\t\t\t\t\t\tbatch: res.message.batch_number,\n\t\t\t\t\t\t\t\t\t\tstock_entry: row.parent\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name, 'batch_no', res.message.batch_number);\n\t\t\t\t\t\t\t\t\t\t\trefresh_field(\"batch_no\");\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfunction(){\n\t\t\t\t\t\t\t\tshow_alert(\"Batch not replaced\")\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\ttemplate : function(frm, cdt, cdn){\n\t\tconsole.log(__(\"template *** \"));\t\n\t\tSetConfiguratorOf(false, frm, cdt, cdn)\t\t\n\t},\n\tcreate_variant : function(frm, cdt, cdn) {\n\t\t// Lancer la fonction \"CreateItemVariant\"lorque le bouton \"create_variant\" est active.\n\t\tCreateItemVariant(false, frm, cdt, cdn, true, false)\n\t},\n\treconfigure : function(doc, cdt, cdn) {\n\t\t// Lancer la fonction \"ReconfigurerItemVariant\" lorque le bouton \"reconfigure\" est active.\n\t\t// dialog_configurator(false,doc, cdt, cdn)\n\t\tReconfigurerItemVariant(false, doc, cdt, cdn)\n\t},\n\tconfigurator_of : function(frm, cdt, cdn) {\t\n\t\tif (frm.doc.shipper){\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'frappe.client.get_value',\n\t\t\t\targs: {\n\t\t\t\t\t'doctype': 'Customer',\n\t\t\t\t\t'filters': {'name': frm.doc.shipper},\n\t\t\t\t\t'fieldname': [\n\t\t\t\t\t\t'milling'\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc) {\t\n\t\t\t\t\t\tif (r.message.milling) {\n\t\t\t\t\t\t\tShowHideAttributes(false, frm, cdt, cdn, false, true)\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tShowHideAttributes(false, frm, cdt, cdn, false, true)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\t\t\t\n\t\t}\n\t\telse {\n\t\t\tShowHideAttributes(false, frm, cdt, cdn, false, true)\n\t\t}\n\t}, \n\tconstruction : function(frm, cdt, cdn) {\n\t\tvar row = locals[cdt][cdn];\t\t\n\t\tshow_construction(false,row)\n\t}\n}); \n\n///////////////////////////// FIN Handles /////////////////////////////\n\n////////////////////////////// Methodes ///////////////////////////////\n\n// 2017-09-13 - RENMAI\n// Script fonctionnel\n// Permet d'assigner les valeurs par defaut des lots a une ligne donnee.\nfunction AssignBatchInfo(printDebug, frm, cdt, cdn) {\n    if (printDebug) console.log(__(\"AssignBatchInfo\"));\n\t\n\tvar row = locals[cdt][cdn];\n    \n\tif (frm.doc.milling && row.milling == \"\"){\n\t\tfrappe.model.set_value(row.doctype, row.name, 'milling', frm.doc.milling);\n\t}\n\tif (frm.doc.prefix && row.prefix_du_lot == \"\"){\n\t\tfrappe.model.set_value(row.doctype, row.name, 'prefix_du_lot', frm.doc.prefix);\n\t}\n\tif (frm.doc.sequence_lot && row.sequence_du_lot == 0){\n\t\tfrappe.model.set_value(row.doctype, row.name, 'sequence_du_lot', frm.doc.sequence_lot);\n\t}\t\n}\n\n\n// 2016-10-24 - JDLP\n// Script fonctionnel\n// Permet d'assigner les valeurs par defaut\n// Ce script doit etre present dans tous les doc utilisant le configurateur\nfunction AssignDefaultValues(printDebug, frm, cdt, cdn) {\n    if (printDebug) console.log(__(\"AssignDefaultValues\"));\n\n    var soi = locals[cdt][cdn];\n    if (soi && soi.item_code) {\n\t\t// 2016-11-02 - JDLP - \n        StockEntryDetailOnItemChange(printDebug, frm, cdt, cdn);\n    }\n}\n\n// 2016-11-22 - JDLP\n// J'ai deplace le code de \"erpnext\\stock\\doctype\\stock_entry\\stock_entry.js\" \"cur_frm.cscript.item_code\"\n// Ceci rentrait en conflit avec le configurateur\nfunction StockEntryDetailOnItemChange(printDebug, frm, cdt, cdn){\n\tif (printDebug) console.log(__(\"StockEntryDetailOnItemChange\"));\n\tvar d = locals[cdt][cdn];\t\t\t\n\tif(d.item_code) {\n\t\targs = {\n\t\t\t'item_code'\t\t\t: d.item_code,\n\t\t\t'warehouse'\t\t\t: cstr(d.s_warehouse) || cstr(d.t_warehouse),\n\t\t\t'transfer_qty'\t\t: d.transfer_qty,\n\t\t\t'serial_no\t'\t\t: d.serial_no,\n\t\t\t'bom_no'\t\t\t: d.bom_no,\n\t\t\t'expense_account'\t: d.expense_account,\n\t\t\t'cost_center'\t\t: d.cost_center,\n\t\t\t'company'\t\t\t: cur_frm.doc.company\n\t\t};\n\t\treturn frappe.call({\n\t\t\tdoc: cur_frm.doc,\n\t\t\tmethod: \"get_item_details\",\n\t\t\targs: args,\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.message) {\n\t\t\t\t\tvar d = locals[cdt][cdn];\n\t\t\t\t\t$.each(r.message, function(k, v) {\n\t\t\t\t\t\td[k] = v;\n\t\t\t\t\t});\n\t\t\t\t\trefresh_field(\"items\");\n\t\t\t\t\tSetVariantOf(true, frm, cdt, cdn, true, false)\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\t\n}\n//////////////////////////// Fin Methodes /////////////////////////////\n///////////////////////// FIN Code specifique /////////////////////////\n///////////////////////////////////////////////////////////////////////\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Delivery Note", 
  "modified": "2018-07-12 14:09:41.110209", 
  "name": "Delivery Note-Client", 
  "script": "///////////////////////////////////////////////////////////////////////\n/////////////////////////// Code sp\u00e9cifique ///////////////////////////\n/////////////////////////////// Handles ///////////////////////////////\n\t\nvar printDebug = false;\n\nfrappe.ui.form.on(\"Delivery Note\",{\n\tonload : function(frm) {\n\t\tcur_frm.add_fetch(\"supplier\", \"milling\", \"milling\");\n\t\tcur_frm.add_fetch(\"supplier\", \"prefix\", \"prefix\");\n\t},\n\trefresh : function(frm){\t\t\n\t\tif (printDebug) console.log(__(\"supplier\"));\n\t\tif (!cur_frm.doc.is_return && cur_frm.doc.status!=\"Closed\") {\t\n\t\t\tif (cur_frm.doc.docstatus===0) {\n\t\t\t\tcur_frm.add_custom_button(__('V\u00e9rifier disponibilit\u00e9s'),\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tconsole.log(__(\"V\u00e9rifier disponibilit\u00e9s\"));\n\t\t\t\t\t}, __(\"Outils\"));\n\t\t\t}\n\t\t}\n\t\t\n\t\t/* cur_frm.add_custom_button(__('Mettre a jour'),\n\t\t\tfunction() {\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod:\"myrador.controllers.status_updater.update_delivery_note_status\",\n\t\t\t\t\tcallback: function(res) {\t\n\t\t\t\t\t\tconsole.log(\"callback\")\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}, __(\"MAJ\")\n\t\t); */\n\t\t\n\t\tif (frm.status !== \"Closed\") {\n\t\t\tme.frm.add_custom_button(__(\"Close\"),function() {update_status(\"Closed\") },\n\t\t\t\t__(\"Status\"))\n\t\t}\n\t\t\n\t\tcur_frm.add_custom_button(__('Close Sales Order Lines'),\n\t\t\tfunction() {\n\t\t\t\tclose_so_line(true)\n\t\t\t}, __(\"MAJ\")\n\t\t);\n\t},\n\ton_submit : function(frm) {\n\t\tclose_so_line(true)\n\t\t\n\t}\n});\n\nfrappe.ui.form.on(\"Delivery Note Item\",{\n\tget_item_from_batch : function(frm,cdt,cdn){\n\t\tvar fields = [\n\t\t\t{'fieldname': 'lot', 'fieldtype': 'Link', 'label': 'Lot', 'options':'Batch'}\n\t\t]\n\t\tvar row = locals[cdt][cdn];\n\t\tvar d = new frappe.ui.Dialog({\n\t\t\ttitle: __('Choisir le lot d\u00e9sir\u00e9'),\n\t\t\tfields: fields,\n\t\t\tprimary_action: function() {\n\t\t\t\tvar data = d.get_values();\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: 'frappe.client.get_value',\n\t\t\t\t\targs: {\n\t\t\t\t\t\t'doctype': 'Batch',\n\t\t\t\t\t\t'filters': {'name': data.lot},\n\t\t\t\t\t\t'fieldname': [\n\t\t\t\t\t\t\t'item'\n\t\t\t\t\t\t]\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tif (!r.exc) {\t\n\t\t\t\t\t\t\tif (r.message.item) {\n\t\t\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name, \"item_code\", r.message.item);\n\t\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\t\t\n\t\t\t},\n\t\t\tprimary_action_label: __('Copier le lot')\n\t\t});\n\t\td.show();\n\t},\n\tduplicate_row : function(frm,cdt,cdn){\n\t\tvar row = locals[cdt][cdn];\n\t\tvar newrow = frappe.model.add_child(frm.doc, \"Delivery Note Item\", \"items\");\n\t\tnewrow.item_code = row.item_code\t\n\t\tnewrow.item_name = row.item_name\t\n\t\tnewrow.description = row.description\t\t\t\t\n\t\tnewrow.qty = row.qty\t\t\n\t\tif (typeof row.rate !== \"undefined\"){\t\t\t\n\t\t\tnewrow.rate = row.rate\n\t\t}\n\t\tif (typeof row.warehouse !== \"undefined\"){\t\t\t\n\t\t\tnewrow.warehouse = row.warehouse\n\t\t}\n\t\tnewrow.stock_uom = row.stock_uom\n\t\tnewrow.expense_account = row.expense_account\n\t\tnewrow.cost_center = row.cost_center\n\t\tnewrow.is_sample_item = row.is_sample_item\n\t\tnewrow.against_sales_order = row.against_sales_order\n\t\tcur_frm.refresh()\n\t\tvar grid_row = frappe.ui.form.get_open_grid_form();\n\t\tgrid_row && grid_row.toggle_view(false, function() { grid_row.open_next() });\n\t},\n\tbatch_no : function(frm,cdt,cdn){\n\t\tvar row = locals[cdt][cdn];\t\t\n\t\tif ((typeof row.nombre_de_boite === 'undefined' || row.nombre_de_boite == 0 ) && (typeof row.batch_no !== 'undefined' ))\n\t\t{\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'frappe.client.get_value',\n\t\t\t\targs: {\n\t\t\t\t\t'doctype': 'Batch',\n\t\t\t\t\t'filters': {'name': row.batch_no},\n\t\t\t\t\t'fieldname': [\n\t\t\t\t\t\t'nombre_de_boite'\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc) {\t\n\t\t\t\t\t\tif (r.message.nombre_de_boite) {\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name, 'nombre_de_boite', r.message.nombre_de_boite);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\t\n\t\t}\n\t\tif ((typeof row.nbr_palette === 'undefined' || row.nbr_palette == 0 ) && (typeof row.batch_no !== 'undefined' ))\n\t\t{\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'frappe.client.get_value',\n\t\t\t\targs: {\n\t\t\t\t\t'doctype': 'Batch',\n\t\t\t\t\t'filters': {'name': row.batch_no},\n\t\t\t\t\t'fieldname': [\n\t\t\t\t\t\t'nbr_palette'\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc) {\t\n\t\t\t\t\t\tif (r.message.nbr_palette) {\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name, 'nbr_palette', r.message.nbr_palette);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\t\n\t\t}\n\t}\n});\n\nfunction update_status(status) {\n\tfrappe.ui.form.is_saving = true;\n\tfrappe.call({\n\t\tmethod:\"erpnext.stock.doctype.delivery_note.delivery_note.update_delivery_note_status\",\n\t\targs: {docname: cur_frm.doc.name, status: status},\n\t\tcallback: function(r){\n\t\t\tif(!r.exc)\n\t\t\t\tcur_frm.reload_doc();\n\t\t},\n\t\talways: function(){\n\t\t\tfrappe.ui.form.is_saving = false;\n\t\t}\n\t})\n }\n\n\n////////////////////////////// Methodes ///////////////////////////////\n\n// 2017-06-08 - RENMAI\n// Script fonctionnel\n// Permet de calculer le taux de sous-traitance.\nfunction close_so_line(printDebug) {\t\n\tfrappe.call({\n\t\tmethod: 'myrador.controllers.stock_controllers.get_sales_order_items_not_fully_delivered',\n\t\targs: {\n\t\t\t'delivery_note': cur_frm.doc.name\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tif(!r.message) {\n\t\t\t\tconsole.log(\"on_submit - !r.message #1\")\n\t\t\t\treturn;\n\t\t\t}\n\t\t\telse if(!r.message) {\n\t\t\t\tconsole.log(\"on_submit - !r.message #2\")\n\t\t\t\treturn;\n\t\t\t} else {\t\t\t\t\t\n\t\t\t\tconsole.log(\"on_submit - msgbox en cours de creation\")\n\t\t\t\tvar fields = [\n\t\t\t\t\t{fieldtype:'Table', fieldname: 'items',\n\t\t\t\t\t\tdescription: __('Select sales order lines to close'),\n\t\t\t\t\t\tfields: [\n\t\t\t\t\t\t\t{fieldtype:'Read Only', fieldname:'item_code',\n\t\t\t\t\t\t\t\tlabel: __('Item Code'), in_list_view:1},\n\t\t\t\t\t\t\t{fieldtype:'Link', fieldname:'sales_order', options: 'Sales Order',\n\t\t\t\t\t\t\t\tlabel: __('Sales Order'), in_list_view:1, read_only:1, get_query: function(doc) {\n\t\t\t\t\t\t\t\t\treturn {filters: {name: doc.sales_order}};\n\t\t\t\t\t\t\t\t}},\n\t\t\t\t\t\t\t{fieldtype:'Read Only', fieldname:'ordered_qty', \n\t\t\t\t\t\t\t\tlabel: __('Ordered Qty'), in_list_view:1},\n\t\t\t\t\t\t\t{fieldtype:'Read Only', fieldname:'delivered_qty',\n\t\t\t\t\t\t\t\tlabel: __('Delivered Qty'), in_list_view:1},\n\t\t\t\t\t\t\t{fieldtype:'Check', fieldname:'completed', \n\t\t\t\t\t\t\t\tlabel: __('Completed'), in_list_view:1},\n\t\t\t\t\t\t\t{fieldtype:'Data', fieldname:'sales_order_item', reqd: 1,\n\t\t\t\t\t\t\t\tlabel: __('Sales Order Item'), hidden:1},\n\t\t\t\t\t\t\t{fieldtype:'Data', fieldname:'delivery_note_item', reqd: 1,\n\t\t\t\t\t\t\t\tlabel: __('Delivery Note Item'), hidden:1}\n\t\t\t\t\t\t],\n\t\t\t\t\t\tget_data: function() {\n\t\t\t\t\t\t\treturn r.message\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t\tvar d = new frappe.ui.Dialog({\n\t\t\t\t\ttitle: __('Select Sales Order Lines to close'),\n\t\t\t\t\tfields: fields,\n\t\t\t\t\tprimary_action: function() {\n\t\t\t\t\t\tvar data = d.get_values();\n\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\tmethod: 'myrador.controllers.stock_controllers.close_sales_order_lines',\n\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\titems: data\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfreeze: true,\n\t\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\t\tif(r.message) {\n\t\t\t\t\t\t\t\t\tfrappe.msgprint({\n\t\t\t\t\t\t\t\t\t\tmessage: __('Sales Orders updated'),\n\t\t\t\t\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tprimary_action_label: __('Update')\n\t\t\t\t});\n\t\t\t\td.show();\n\t\t\t}\n\t\t}\n\t});\n}", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Timesheet", 
  "modified": "2018-04-02 20:43:19.887541", 
  "name": "Timesheet-Client", 
  "script": "///////////////////////////////////////////////////////////////////////\n/////////////////////////// Code sp\u00e9cifique ///////////////////////////\n/////////////////////////////// Handles ///////////////////////////////\n\t\nvar printDebug = true;\n\nfrappe.ui.form.on(\"Timesheet\",{\n\ttime_logs_on_form_rendered : function(frm) {\n\t\tconsole.log(\"1\")\n\t\tsetTimeout(function() {\t\t\t\n\t\t\tconsole.log(\"2\")\n\t\t\tvar grid_row = cur_frm.open_grid_row();\t\t\n\t\t\tvar field = grid_row.grid_form.fields_dict.from_time\n\t\t\tset_focus(field);\n\t\t}, 800);\t\n\t}\n});\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Production Order Operation Scheduler", 
  "modified": "2018-08-24 15:04:59.398684", 
  "name": "Production Order Operation Scheduler-Client", 
  "script": "frappe.ui.form.on(\"Production Order Operation Scheduler\",{\n\tonload : function(frm) {\n\t\tvar slideWidth = $(window).width();\n\t\t$('.container').css('width', slideWidth );\n\t}\n});\n", 
  "script_type": "Client"
 }
]